# Tags:
# - nodoc : Do not include in documentation
# - ignore_fail : If it fails, ignore it, it's a cleanup
# - must_fail : Must fail case.
# - hide_fail : Do not show failure
# Shares ------------------------------------------------------
shares_health:
  command:
    - shares
    - health
  tags:
    - must_fail
shares_health_bad:
  tags:
    - nodoc
  command:
    - shares
    - health
    - --url=https://wrong.example.com
shares_detect:
  command:
    - config
    - detect
    - "@preset:shares_admin.url"
    - shares
shares_wizard:
  command:
    - config
    - wizard
    - "@preset:shares_admin.url"
    - shares
    - --username=test
    - --password=test
shares_admin_1:
  command:
    - shares
    - admin
    - node
    - list
shares_admin_2:
  command:
    - shares
    - admin
    - group
    - all
    - list
shares_admin_3:
  command:
    - shares
    - admin
    - user
    - all
    - list
shares_admin_4:
  command:
    - shares
    - admin
    - user
    - local
    - list
shares_admin_5:
  command:
    - shares
    - admin
    - user
    - all
    - app_authorizations
    - "%username:@preset:shares_admin.username"
    - show
shares_admin_6:
  command:
    - shares
    - admin
    - user
    - all
    - app_authorizations
    - "%username:@preset:shares_admin.username"
    - modify
    - '@json:{"app_login":true}'
shares_admin_7:
  command:
    - shares
    - admin
    - user
    - all
    - share_permissions
    - "%username:@preset:shares_admin.username"
    - list
shares_admin_8:
  command:
    - shares
    - admin
    - user
    - all
    - share_permissions
    - "%username:@preset:shares_admin.username"
    - show
    - "%name:@preset:shares.share"
shares_admin_9:
  command:
    - shares
    - admin
    - user
    - saml
    - import
    - '@json:{"id":"the_id","name_id":"the_name"}'
shares_admin_10:
  tags:
    - hide_fail
  command:
    - shares
    - admin
    - user
    - ldap
    - add
    - the_name
shares_admin_11:
  command:
    - shares
    - admin
    - share
    - list
    - --fields=DEF,-status,status_message
shares_admin_12:
  command:
    - shares
    - admin
    - share
    - user_permissions
    - "%name:@preset:shares.share"
    - list
shares_1:
  command:
    - shares
    - files
    - browse
    - /
shares_2:
  command:
    - shares
    - files
    - upload
    - --to-folder=@preset:shares.share_folder
    - $(TST_ASC_LCL_PATH)
shares_3:
  depends_on:
    - shares_2
  command:
    - shares
    - files
    - download
    - --to-folder=$(TMP)
    - "@extend:@preset:shares.share_folder@/@preset:file.asc_name@"
shares_4:
  depends_on:
    - shares_3
  command:
    - shares
    - files
    - delete
    - "@extend:@preset:shares.share_folder@/@preset:file.asc_name@"
shares_5:
  depends_on:
    - shares_4
  command:
    - shares
    - files
    - upload
    - --to-folder=@preset:shares.share_folder
    - $(TST_ASC_LCL_PATH)
    - --transfer=httpgw
    - --preset=no_wss
    - --transfer-info=@json:@extend:{"url":"@preset:tst_httpgw.url@"}
shares_6:
  command:
    - shares
    - files
    - upload
    - faux:///testfile?1m
    - --to-folder=@preset:shares.share_folder
    - --transfer=httpgw
    - --preset=no_wss
    - --transfer-info=@json:@extend:{"url":"@preset:tst_httpgw.url@","synchronous":true,"api_version":"v1","upload_chunk_size":100000}
shares_6bis:
  command:
    - shares
    - files
    - upload
    - $(TST_LCL_FOLDER)
    - --to-folder=@preset:shares.share_folder
    - --transfer=httpgw
    - --preset=no_wss
    - --transfer-info=@json:@extend:{"url":"@preset:tst_httpgw.url@","synchronous":true,"api_version":"v1","upload_chunk_size":100000}
shares_7:
  depends_on:
    - shares_5
  command:
    - shares
    - files
    - download
    - --to-folder=$(TMP)
    - "@extend:@preset:shares.share_folder@/@preset:file.asc_name@"
    - "@extend:@preset:shares.share_folder@/@preset:file.asc_name@"
    - --transfer=httpgw
    - --preset=no_wss
    - --transfer-info=@json:@extend:{"url":"@preset:tst_httpgw.url@"}
shares_8:
  depends_on:
    - shares_7
  command:
    - shares
    - files
    - delete
    - "@extend:@preset:shares.share_folder@/@preset:file.asc_name@"
shares_9_prep:
  tags:
    - ignore_fail
    - nodoc
  command:
    - shares
    - files
    - delete
    - "@extend:@preset:shares.share_folder@/new_folder"
shares_9:
  depends_on:
    - shares_9_prep
  command:
    - shares
    - files
    - mkdir
    - "@extend:@preset:shares.share_folder@/new_folder"
shares_10:
  depends_on:
    - shares_9
  command:
    - shares
    - files
    - delete
    - "@extend:@preset:shares.share_folder@/new_folder"
shares_sync_prepare:
  tags:
    - ignore_fail
  command:
    - shares
    - files
    - mkdir
    - "@extend:@preset:shares.share_folder@/synctst"
shares_sync_1:
  depends_on:
    - shares_sync_prepare
  command:
    - shares
    - files
    - sync
    - push
    - $(SHARES_SYNC)
    - --to-folder=@extend:@preset:shares.share_folder@/synctst
    - '@json:{"reset":true}'
shares_sync_2:
  depends_on:
    - shares_sync_1
  command:
    - shares
    - files
    - sync
    - push
    - $(SHARES_SYNC)
    - --to-folder=@extend:@preset:shares.share_folder@/synctst
# Server ------------------------------------------------------
serv_health:
  command:
    - server
    - health
    - transfer
    - --to-folder=@preset:server.upload_folder
serv_health_bad:
  command:
    - server
    - health
    - transfer
    - --url=ssh://wrong.example.com
serv_detect:
  command:
    - config
    - detect
    - "@preset:server_user.url"
    - server
serv_wizard:
  command:
    - config
    - wizard
    - "@preset:server_user.url"
    - server
    - --username=@preset:server_user.username
    - --password=@preset:server_user.password
serv_wizard2:
  tags:
    - nodoc
  command:
    - config
    - wizard
    - "@preset:server.address"
    - server
    - srv2
    - --username=@preset:server_user.username
    - --password=@preset:server_user.password
serv_browse:
  command:
    - server
    - browse
    - /
serv_mkdir:
  command:
    - server
    - mkdir
    - "@preset:server.inside_folder"
    - --logger=stdout
serv_error1:
  tags:
    - hide_fail
  command:
    - server
    - -Pserver2_user
    - --password=wrong
    - upload
    - $(TST_ASC_LCL_PATH)
    - --transfer-info=@json:{"monitor":false,"resume":{"iter_max":0}}
serv_error2:
  tags:
    - hide_fail
  command:
    - server
    - -Pserver2_user
    - --password=wrong
    - browse
    - /
    - --ssh-options=@json:{"number_of_password_prompts":0}
serv_error3:
  tags:
    - hide_fail
  command:
    - server
    - -N
    - --url=foo://
    - ls
    - .
serv_error4:
  tags:
    - hide_fail
  command:
    - server
    - -N
    - --url=@preset:node_user.url
    - upload
    - wrong
    - --ts=@json:{"token":"test"}
    - --transfer-info=@json:{"resume":{"iter_max":0}}
serv_error5:
  tags:
    - hide_fail
  command:
    - server
    - -N
    - --url=@preset:node_user.url
    - upload
    - wrong
    - --transfer-info=@json:{"resume":{"iter_max":0}}
serv_ls_local:
  command:
    - server
    - -N
    - --url=local://
    - ls
    - .
serv_upload1:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - $(TST_MED_LCL_PATH)
    - --to-folder=@preset:server.inside_folder
    - --ts=@json:{"multi_session":3,"multi_session_threshold":1,"resume_policy":"none","target_rate_kbps":100000}
    - --transfer-info=@json:{"spawn_delay_sec":2.5,"multi_incr_udp":false}
    - --progress-bar=yes
serv_upload1b:
  depends_on:
    - serv_upload1
  command:
    - server
    - browse
    - "@extend:@preset:server.inside_folder@/$(TST_MED_FILENAME)"
serv_upload2:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - --src-type=pair
    - $(TST_MED_LCL_PATH)
    - "@extend:@preset:server.inside_folder@/other_name_2"
    - --notify-to=@preset:misc.email_external
    - --transfer-info=@json:{"ascp_args":["-l","100m"]}
serv_upload3_prep:
  tags:
    - ignore_fail
  depends_on:
    - serv_mkdir
  command:
    - server
    - delete
    - "@extend:@preset:server.inside_folder@/other_name_3"
serv_upload3:
  depends_on:
    - serv_upload3_prep
  command:
    - server
    - upload
    - --src-type=pair
    - --sources=@json:@extend:["$(TST_ASC_LCL_PATH)","@preset:server.inside_folder@/other_name_3"]
    - --transfer-info.quiet=false
    - --progress=no
serv_upload4:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - --sources=@ts
    - --ts=@json:@extend:{"paths":[{"source":"$(TST_ASC_LCL_PATH)","destination":"@preset:server.inside_folder@/other_name_4"}]}
    - --transfer=transferd
serv_upload5:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - --src-type=pair
    - $(TST_ASC_LCL_PATH)
    - "@extend:@preset:server.upload_folder@/other_name_5"
    - --ts=@json:{"cipher":"aes-192-gcm","content_protection":"encrypt","content_protection_password":"my_secret_here","cookie":"biscuit","create_dir":true,"delete_before_transfer":false,"delete_source":false,"exclude_newer_than":"-1","exclude_older_than":"-10000","fasp_port":33001,"http_fallback":false,"multi_session":0,"overwrite":"diff+older","precalculate_job_size":true,"preserve_access_time":true,"preserve_creation_time":true,"rate_policy":"fair","resume_policy":"sparse_csum","symlink_policy":"follow"}
serv_sync_pull_args_reset:
  description: Sync using args syntax (reset)
  reset_folder: $(TMP_SYNCS / 'serv_sync_pull_args')
  tags:
    - nodoc
  depends_on:
    - serv_upload1
    - serv_upload2
    - serv_upload3
    - serv_upload5
  command:
    - server
    - sync
    - pull
    - "@preset:server.inside_folder"
    - --to-folder=$(TMP_SYNCS / 'serv_sync_pull_args')
    - '@json:@extend:{"instance":{"quiet":false},"sessions":[{"name":"serv_sync_pull_args","target_rate":"@preset:sync.bps@","reset":true}]}'
serv_sync_pull_args_status1:
  tags:
    - nodoc
  depends_on:
    - serv_sync_pull_args_reset
  command:
    - server
    - sync
    - admin
    - status
    - $(TMP_SYNCS / 'serv_sync_pull_args')
    - '@json:{"sessions":[{"name":"serv_sync_pull_args"}]}'
serv_sync_pull_args_sync2:
  tags:
    - nodoc
  depends_on:
    - serv_sync_pull_args_status1
  command:
    - server
    - sync
    - admin
    - meta
    - $(TMP_SYNCS / 'serv_sync_pull_args')
    - '@json:{"sessions":[{"name":"serv_sync_pull_args"}]}'
serv_sync_pull_args_counters:
  tags:
    - nodoc
  depends_on:
    - serv_sync_pull_args_sync2
  command:
    - config
    - sync
    - admin
    - counters
    - $(TMP_SYNCS / 'serv_sync_pull_args')
    - '@json:{"sessions":[{"name":"serv_sync_pull_args"}]}'
serv_sync_pull_conf_reset:
  reset_folder: $(TMP_SYNCS / 'serv_sync_pull_conf')
  depends_on:
    - serv_sync_pull_args_counters
  command:
    - server
    - sync
    - pull
    - "@preset:server.inside_folder"
    - --to-folder=$(TMP_SYNCS / 'serv_sync_pull_conf')
    - '@json:@extend:{"name":"serv_sync_pull_conf","reset":true,"transport":{"target_rate":@preset:sync.bps@}}'
serv_sync_pull_conf_status_fail:
  depends_on:
    - serv_sync_pull_conf_reset
  tags:
    - hide_fail
  command:
    - server
    - sync
    - admin
    - status
    - '@json:{"name":"serv_sync_pull_conf"}'
serv_sync_pull_conf_status:
  depends_on:
    - serv_sync_pull_conf_reset
  command:
    - server
    - sync
    - admin
    - status
    - $(TMP_SYNCS / 'serv_sync_pull_conf')
    - '@json:{"name":"serv_sync_pull_conf"}'
serv_sync_pull_conf_sync:
  depends_on:
    - serv_sync_pull_conf_reset
  command:
    - server
    - sync
    - pull
    - "@preset:server.inside_folder"
    - --to-folder=$(TMP_SYNCS / 'serv_sync_pull_conf')
    - '@json:@extend:{"name":"serv_sync_pull_conf"}'
serv_sync_pull_conf_status2:
  depends_on:
    - serv_sync_pull_conf_sync
  command:
    - server
    - sync
    - admin
    - status
    - $(TMP_SYNCS / 'serv_sync_pull_conf')
serv_sync_pull_conf_overview:
  depends_on:
    - serv_sync_pull_conf_sync
  command:
    - server
    - sync
    - admin
    - overview
    - $(TMP_SYNCS / 'serv_sync_pull_conf')
serv_sync_pull_conf_fileinfo:
  depends_on:
    - serv_sync_pull_conf_sync
  command:
    - server
    - sync
    - admin
    - file_info
    - $(TMP_SYNCS / 'serv_sync_pull_conf')
serv_upload_ex_list:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - --sources=@ts
    - --transfer-info=@json:{"ascp_args":["--file-list","$(TMP / 'filelist.txt')"]}
    - --to-folder=@preset:server.inside_folder
serv_upload_ex_pair:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - --sources=@ts
    - --transfer-info=@json:{"ascp_args":["--file-pair-list","$(TMP / 'file_pair_list.txt')"]}
serv_md5:
  depends_on:
    - serv_upload1
  command:
    - server
    - md5sum
    - "@extend:@preset:server.inside_folder@/$(TST_ASC_FILENAME)"
serv_down_lcl:
  depends_on:
    - serv_upload1
  command:
    - server
    - download
    - "@extend:@preset:server.inside_folder@/$(TST_ASC_FILENAME)"
    - --to-folder=$(TMP)
    - --transfer-info=@json:{"wss":false,"resume":{"iter_max":1}}
serv_down_from_node:
  command:
    - server
    - download
    - "@preset:server.large_file"
    - --to-folder=@preset:server.upload_folder
    - --transfer=node
    - --ts.resume_policy=none
serv_down_from_node_fail:
  tags:
    - hide_fail
  command:
    - server
    - download
    - file_does_not_exist.random
    - --to-folder=@preset:server.upload_folder
    - --transfer=node
serv_cp:
  depends_on:
    - serv_upload1
  command:
    - server
    - cp
    - "@extend:@preset:server.inside_folder@/$(TST_ASC_FILENAME)"
    - "@extend:@preset:server.upload_folder@/200KB.2"
serv_mv:
  depends_on:
    - serv_cp
  command:
    - server
    - mv
    - "@extend:@preset:server.upload_folder@/200KB.2"
    - "@extend:@preset:server.upload_folder@/to.delete"
serv_delete:
  depends_on:
    - serv_mv
  command:
    - server
    - delete
    - "@extend:@preset:server.upload_folder@/to.delete"
serv_cleanup1:
  depends_on:
    - serv_cp
    - serv_down_from_node
    - serv_down_lcl
    - serv_md5
  command:
    - server
    - delete
    - "@preset:server.inside_folder"
serv_info:
  command:
    - server
    - info
serv_du:
  command:
    - server
    - du
    - /
serv_df:
  command:
    - server
    - df
serv_health_xfer_nagios:
  command:
    - server
    - health
    - transfer
    - --to-folder=@preset:server.upload_folder
    - --format=nagios
serv_health_xfer_nagios_fail:
  tags:
    - must_fail
  command:
    - server
    - health
    - transfer
    - --to-folder=/wrong
    - --format=nagios
serv_key_path:
  tags:
    - save_output
  command:
    - config
    - ascp
    - info
    - --fields=ssh_private_rsa
serv_key:
  command:
    - server
    - browse
    - /
    - "--password=@none:"
    - --ssh-options=@json:{"number_of_password_prompts":0}
    - --ssh-keys=$(read_value_from 'serv_key_path')
serv_pr1:
  command:
    - server
    - upload
    - "faux:///test1?100m"
    - "faux:///test2?100m"
    - --to-folder=/Upload
    - --ts=@json:{"target_rate_kbps":1000000,"resume_policy":"none","precalculate_job_size":true}
    - --transfer-info=@json:{"quiet":false}
    - --progress=no
serv_pr2:
  command:
    - server
    - upload
    - "faux:///test1?100m"
    - "faux:///test2?100m"
    - --to-folder=/Upload
    - --ts=@json:{"target_rate_kbps":1000000,"resume_policy":"none","precalculate_job_size":true}
# Console ------------------------------------------------------
cons_health:
  command:
    - console
    - health
cons_health_bad:
  command:
    - console
    - health
    - --url=https://wrong.example.com
cons_detect:
  command:
    - config
    - detect
    - "@preset:console_admin.url"
cons_wizard:
  command:
    - config
    - wizard
    - "@preset:console_admin.url"
    - console
    - --preset=console_admin
cons_cur_lst:
  command:
    - console
    - transfer
    - current
    - list
    - --query=@json:{"filter1":"transfer_name","comp1":"contain","val1":"aoc"}
cons_cur_lst_ex:
  command:
    - console
    - transfer
    - current
    - list
    - --query.filter=(transfer_name contain aoc)
cons_cur_lst_one:
  tags:
    - save_output
  command:
    - console
    - transfer
    - current
    - list
    - --fields=id
    - --format=csv
cons_cur_show_one:
  depends_on:
    - cons_cur_lst_one
  command:
    - console
    - transfer
    - current
    - show
    - $(read_value_from('cons_cur_lst_one').split("\n").last)
cons_cur_show_one1:
  depends_on:
    - cons_cur_lst_one
  command:
    - console
    - transfer
    - current
    - files
    - $(read_value_from('cons_cur_lst_one').split("\n").last)
cons_cur_show_one2:
  tags:
    - nodoc
    - ignore_fail
  depends_on:
    - cons_cur_lst_one
  command:
    - console
    - transfer
    - current
    - resume
    - $(read_value_from('cons_cur_lst_one').split("\n").last)
cons_sma_lst:
  command:
    - console
    - transfer
    - smart
    - list
cons_sma_sta:
  tags:
    - ignore_fail
  command:
    - console
    - transfer
    - smart
    - sub
    - "@preset:console.smart_id"
    - '@json:@extend:{"source":{"paths":["@preset:console.smart_file@"]},"source_type":"user_selected"}'
# Node ------------------------------------------------------
# nodegen3
nd_health:
  command:
    - node
    - health
nd_health_bad:
  command:
    - node
    - health
    - --url=https://wrong.example.com
nd_detect:
  command:
    - config
    - detect
    - "@preset:node_user.url"
nd_wizard:
  command:
    - config
    - wizard
    - "@preset:node_user.url"
    - node
    - --username=test
    - --password=test
nd_info:
  command:
    - node
    - info
    - --fpac=function FindProxyForURL(url,host){return "DIRECT"}
nd_lic:
  command:
    - node
    - license
nd_det:
  command:
    - node
    - api_details
nd_tra:
  command:
    - node
    - transport
nd_bro:
  command:
    - node
    - browse
    - /
    - --log-level=trace2
nd_sea:
  command:
    - node
    - search
    - /
    - --query=@json:{"sort":"mtime"}
nd_spa:
  command:
    - node
    - space
    - /
nd_del_err:
  tags:
    - ignore_fail
    - nodoc
  command:
    - node
    - delete
    - /a_folder
nd_folder:
  depends_on:
    - nd_del_err
  command:
    - node
    - mkdir
    - "@extend:@preset:server.upload_folder@/a_folder"
nd_folder2:
  depends_on:
    - nd_folder
  command:
    - node
    - mklink
    - "@extend:@preset:server.upload_folder@/a_folder"
    - "@extend:@preset:server.upload_folder@/tdlink"
nd_folder3:
  depends_on:
    - nd_folder
  command:
    - node
    - mkfile
    - "@extend:@preset:server.upload_folder@/a_file1"
    - "hello world"
nd_folder4:
  depends_on:
    - nd_folder3
  command:
    - node
    - rename
    - "@preset:server.upload_folder"
    - a_file1
    - a_file
nd_folder5:
  depends_on:
    - nd_folder
    - nd_folder2
    - nd_folder3
    - nd_folder4
  command:
    - node
    - delete
    - "@list:@extend:,@preset:server.upload_folder@/a_folder,@preset:server.upload_folder@/tdlink,@preset:server.upload_folder@/a_file"
nd2:
  command:
    - node
    - upload
    - $(TST_ASC_LCL_PATH)
    - --to-folder=@preset:server.upload_folder
    - --ts=@json:{"target_rate_cap_kbps":10000}
nd2b:
  depends_on:
    - nd2
  command:
    - node
    - download
    - "@extend:@preset:server.upload_folder@/$(TST_ASC_FILENAME)"
    - --to-folder=$(TMP)
nd2c:
  depends_on:
    - nd2b
  command:
    - node
    - delete
    - "@extend:@preset:server.upload_folder@/$(TST_ASC_FILENAME)"
nd_slash:
  command:
    - node
    - slash
nd2_http:
  command:
    - node
    - upload
    - $(TST_ASC_LCL_PATH)
    - --to-folder=@preset:server.upload_folder
    - --ts=@json:{"target_rate_cap_kbps":10000}
nd2_httpb:
  depends_on:
    - nd2_http
  command:
    - node
    - cat
    - "@extend:@preset:server.upload_folder@/$(TST_ASC_FILENAME)"
nd2_httpc:
  depends_on:
    - nd2_httpb
  command:
    - node
    - delete
    - "@extend:@preset:server.upload_folder@/$(TST_ASC_FILENAME)"
nd_2_nd_xfer:
  command:
    - node
    - upload
    - --to-folder=@preset:server.upload_folder
    - --sources=@ts
    - --ts=@json:{"paths":[{"source":"/aspera-test-dir-small/10MB.2"}],"precalculate_job_size":true}
    - --transfer=node
    - --transfer-info=@json:@extend:{"url":"@preset:node_user.url@","username":"@preset:node_user.username@","password":"@preset:node_user.password@"}
nd_2_nd_xferb:
  depends_on:
    - nd_2_nd_xfer
  tags:
    - ignore_fail
  command:
    - node
    - delete
    - "@extend:@preset:server.upload_folder@/10MB.2"
nd_service_clean:
  tags:
    - ignore_fail
    - nodoc
  command:
    - --preset=node_ak_adm
    - node
    - service
    - delete
    - service1
  post:
    - sleep TEMPORIZE_CREATE
nd_service_create:
  depends_on:
    - nd_service_clean
  command:
    - --preset=node_ak_adm
    - node
    - service
    - create
    - '@json:{"id":"service1","type":"WATCHD","run_as":{"user":"user1"}}'
nd_service_list:
  depends_on:
    - nd_service_create
  command:
    - --preset=node_ak_adm
    - node
    - service
    - list
  post:
    - sleep TEMPORIZE_CREATE
nd_service_delete:
  depends_on:
    - nd_service_list
  command:
    - --preset=node_ak_adm
    - node
    - service
    - delete
    - service1
nd_service_list_del:
  depends_on:
    - nd_service_delete
  command:
    - --preset=node_ak_adm
    - node
    - service
    - list
  post:
    - sleep TEMPORIZE_CREATE
nd_service_list_del2:
  depends_on:
    - nd_service_list_del
  command:
    - --preset=node_ak_adm
    - node
    - service
    - list
  post:
    - sleep TEMPORIZE_CREATE
nd_service_list_del3:
  depends_on:
    - nd_service_list_del2
  command:
    - --preset=node_ak_adm
    - node
    - service
    - list
nd_xfer_lst:
  command:
    - node
    - transfer
    - list
    - --query=@json:{"active_only":true}
nd_xfer_lstb:
  command:
    - node
    - transfer
    - list
    - --query=@json:{"reset":true}
    - --once-only=yes
nd_xfer_lst_once1:
  tags:
    - ignore_fail
  depends_on:
    - nd_xfer_lstb
  command:
    - node
    - transfer
    - list
    - --once-only=yes
nd_xfer_lst_once2:
  tags:
    - ignore_fail
    - nodoc
  depends_on:
    - nd_xfer_lst_once1
  command:
    - node
    - transfer
    - list
    - --once-only=yes
nd_xfer_sess_lst:
  command:
    - node
    - transfer
    - sessions
nd_xfer_ops:
  tags:
    - nodoc
    - noblock
  command:
    - node
    - upload
    - --to-folder=@preset:server.upload_folder
    - --ts=@json:{"target_rate_kbps":1000,"resume_policy":"none"}
    - faux:///bigfile?10G
    - --progress=no
  post:
    - sleep 5
nd_xfer_ops2:
  tags:
    - save_output
  command:
    - node
    - transfer
    - list
    - --query=@json:{"active_only":true,"count":1}
    - --fields=id
nd_xfer_ops3:
  command:
    - node
    - transfer
    - show
    - $(read_value_from 'nd_xfer_ops2')
nd_xfer_ops4:
  command:
    - node
    - transfer
    - modify
    - $(read_value_from 'nd_xfer_ops2')
    - '@json:{"target_rate_kbps":10000}'
nd_xfer_ops5:
  command:
    - node
    - transfer
    - show
    - $(read_value_from 'nd_xfer_ops2')
nd_xfer_ops6:
  command:
    - node
    - transfer
    - cancel
    - $(read_value_from 'nd_xfer_ops2')
nd_xfer_ops7:
  command:
    - node
    - transfer
    - bandwidth_average
nd_xfer_ops8:
  command:
    - node
    - transfer
    - sessions
node_basic_token:
  command:
    - node
    - basic_token
nd_browser:
  command:
    - node
    - asperabrowser
nd8:
  command:
    - node
    - upload
    - --username=@preset:aoc.ak_name
    - --password=@preset:aoc.ak_secret
    - $(TST_ASC_LCL_PATH)
nd_central_1:
  command:
    - node
    - central
    - session
    - list
nd_central_1b:
  command:
    - node
    - central
    - file
    - list
nd_central_1c:
  command:
    - node
    - central
    - file
    - modify
    - --validator=1
    - '@json:{"files":[]}'
nd_watch_1:
  command:
    - node
    - watch_folder
    - list
    - --preset=node_ak_adm
nd_watch_1b:
  tags:
    - hide_fail
    - nodoc
  command:
    - node
    - watch_folder
    - create
    - '@json:{"source":{"path":"/src1"},"target":{"path":"/dst1"}}'
    - --preset=node_ak_adm
nd_stream_1:
  command:
    - --preset=node_ak_adm
    - node
    - stream
    - list
nd_ak:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - list
nd_akb:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - node_info
    - /
nd_akc:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - browse
    - /
nd_akd:
  tags:
    - must_fail
    - nodoc
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - find
    - "@json:{}"
nd_ake:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - find
    - "@preset:aoc.test_folder"
    - "@ruby:->(f){f['name'].end_with?('.jpg')}"
nd_akf:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - find
    - "@preset:aoc.test_folder"
    - '@re:\.jpg$'
nd_akg:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - find
    - "@preset:aoc.test_folder"
nd_ak_mkdir:
  tags:
    - ignore_fail
    - nodoc
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - delete
    - /tst_nd_ak
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mkdirb:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - mkdir
    - /tst_nd_ak
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mkfile:
  tags:
    - ignore_fail
    - nodoc
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - delete
    - /mkfile.txt
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mkfileb:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - mkfile
    - /mkfile.txt
    - "hello
    - world"
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mklink:
  depends_on:
    - nd_ak_mkfile
  tags:
    - ignore_fail
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - delete
    - /mklink.txt
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mklinkb:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - mklink
    - /mklink.txt
    - --query=@json:{"target":"/mkfile.txt","target_node_id":"123"}
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mvdir:
  depends_on:
    - nd_ak_mkdir
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - browse
    - /
    - --node-cache=no
nd_ak_mvdirb:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - rename
    - /tst_nd_ak
    - test_nd_ak2
nd_ak_deldir:
  depends_on:
    - nd_ak_mvdir
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - delete
    - /test_nd_ak2
nd_ak3:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - upload
    - 'faux:///test_nd_ak3?100k'
    - --default-ports=no
nd_ak3b:
  depends_on:
    - nd_ak3
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - download
    - test_nd_ak3
    - --to-folder=$(TMP)
nd_ak3c:
  depends_on:
    - nd_ak3
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - show
    - /test_nd_ak3
  tags:
    - hide_fail
nd_ak3d:
  tags:
    - hide_fail
  depends_on:
    - nd_ak3
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - thumbnail
    - /test_nd_ak3
nd_ak3e:
  depends_on:
    - nd_ak3b
    - nd_ak3c
    - nd_ak3d
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - delete
    - test_nd_ak3
nd_ak4:
  depends_on:
    - nd_ak3e
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - show
    - "%id:1"
nd_ak_bearer_reset:
  tags:
    - ignore_fail
    - nodoc
  command:
    - node
    - -N
    - --preset=tst_node_preview
    - access_key
    - delete
    - "@preset:ak_creds.username"
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_bearer_create:
  depends_on:
    - nd_ak_bearer_reset
  command:
    - node
    - -N
    - --preset=tst_node_preview
    - access_key
    - create
    -  '@json:@extend:{"id":"@preset:ak_creds.username@","secret":"@preset:ak_creds.password@","storage":{"type":"local","path":"/"}}'
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_bearer_show:
  depends_on:
    - nd_ak_bearer_create
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - access_key
    - show
    - "%id:self"
nd_ak_bearer_set_key:
  depends_on:
    - nd_ak_bearer_create
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - access_key
    - set_bearer_key
    - self
    - "@file:@preset:file.private_key"
nd_ak_bearer_show_root:
  depends_on:
    - nd_ak_bearer_create
  tags:
    - save_output
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - access_key
    - do
    - self
    - show
    - /
    - --fields=id
nd_ak_bearerf:
  depends_on:
    - nd_ak_bearer_create
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - access_key
    - do
    - self
    - permission
    - "%id:$(read_value_from 'nd_ak_bearer_show_root')"
    - create
    - '@json:{"access_type":"user","access_id":"666"}'
nd_ak_bearerg:
  depends_on:
    - nd_ak_bearerf
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - access_key
    - do
    - self
    - permission
    - /
    - show
    - 1
nd_ak_bearerh:
  depends_on:
    - nd_ak_bearer_create
  tags:
    - save_output
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - bearer_token
    - "@file:@preset:file.private_key"
    - '@json:{"user_id":"666"}'
nd_ak_beareri:
  depends_on:
    - nd_ak_bearer_create
  command:
    - -N
    - node
    - --url=@preset:tst_node_preview.url
    - --password=Bearer $(read_value_from 'nd_ak_bearerh')
    - --root-id=$(read_value_from 'nd_ak_bearer_show_root')
    - access_key
    - do
    - self
    - br
    - /
nd_ak_bearer_del_perm:
  depends_on:
    - nd_ak_beareri
  command:
    - -N
    - --preset=tst_node_preview
    - node
    - --preset=ak_creds
    - access_key
    - do
    - self
    - permission
    - /
    - delete
    - 1
nd_ak_bearerk:
  depends_on:
    - nd_ak_bearer_del_perm
  command:
    - -N
    - --preset=tst_node_preview
    - node
    - access_key
    - delete
    - "@preset:ak_creds.username"
# AoC ------------------------------------------------------
aoc_detect:
  command:
    - config
    - detect
    - "@preset:aoc.org"
    - aoc
aoc_wizard:
  command:
    - config
    - tokens
    - flush
aoc_wizardb:
  command:
    - config
    - tokens
    - list
aoc_wizardc:
  command:
    - config
    - wizard
    - "@preset:aoc.org"
    - aoc
    - --key-path=@preset:file.private_key
    - --username=@preset:aoc.user_email
    - --use-generic-client=yes
aoc_wizard_2:
  command:
    - config
    - tokens
    - flush
  tags:
    - hide_fail
aoc_wizard_2b:
  tags:
    - must_fail
  command:
    - config
    - tokens
    - show
    - foobar
aoc_wizard_2c:
  depends_on:
    - aoc_wizard_2
  command:
    - config
    - wizard
    - "@preset:aoc.org"
    - aoc
    - mypreset
    - --key-path=@preset:file.private_key
    - --username=@preset:aoc.user_email
aoc_faspex_gateway:
  tags:
    - noblock
  command:
    - aoc
    - gateway
    - '@json:{"url":"https://localhost:12345/aspera/faspex"}'
aoc_faspex_gatewayb:
  command:
    - -N
    - faspex
    - --url=https://localhost:12345/aspera/faspex
    - --username=_unused_
    - --password=_unused_
    - --warn-insecure=yes
    - package
    - send
    - --delivery-info=@json:{"recipients":["laurent.martin.aspera@fr.ibm.com"],"title":"gateway aoc"}
    - faux:///test1?1m
  post:
    - stop_process 'aoc_faspex_gateway'
aocg1:
  command:
    - -N
    - aoc
    - servers
aocg1b:
  command:
    - -N
    - aoc
    - remind
    - --username=@preset:aoc.user_email
aocg2:
  command:
    - aoc
    - bearer_token
    - --display=data
    - --scope=user:all
aocg3:
  command:
    - aoc
    - organization
aocg3b:
  command:
    - aoc
    - organization
    - --format=image
    - --fields=background_image_url
    - --ui=text
aocg3c:
  command:
    - aoc
    - tier_restrictions
aocg4:
  command:
    - aoc
    - user
    - workspaces
    - list
aoc_user_profile:
  command:
    - aoc
    - user
    - profile
    - show
aocg6:
  command:
    - aoc
    - user
    - profile
    - modify
    - '@json:{"name":"dummy change"}'
aocuprefshow:
  command:
    - aoc
    - user
    - pref
    - show
aocuprefmod:
  command:
    - aoc
    - user
    - pref
    - modify
    - '@json:{"default_language":"en-us"}'
aocucontactlist:
  command:
    - aoc
    - user
    - contacts
    - list
aocg7:
  command:
    - aoc
    - packages
    - shared_inboxes
    - list
aocg7b:
  command:
    - aoc
    - packages
    - shared_inboxes
    - show
    - "%name:@preset:aoc.shared_inbox_name"
aocg8:
  command:
    - aoc
    - user
    - workspaces
    - current
aoc_webauth:
  command:
    - --preset=aoc_web
    - aoc
    - user
    - profile
    - show
aoc_webauthb:
  command:
    - --preset=aoc_web
    - aoc
    - user
    - profile
    - show
    - --http-options=@json:{"token_refresh_threshold":10000000000}
aocfbr:
  command:
    - aoc
    - files
    - browse
    - /
aocfbr1:
  command:
    - aoc
    - files
    - browse
    - "@preset:aoc.remote_folder"
aocfbr1b:
  command:
    - aoc
    - files
    - browse
    - "@extend:@preset:aoc.remote_folder@/"
aocfbr1c:
  command:
    - aoc
    - files
    - browse
    - "@preset:aoc.remote_file"
aocfbt:
  command:
    - aoc
    - files
    - bearer_token_node
    - /
    - --cache-tokens=no
aocffin:
  command:
    - aoc
    - files
    - find
    - /
aocffinb:
  command:
    - aoc
    - files
    - find
    - /
    - \.partial$
aocffinc:
  command:
    - aoc
    - files
    - find
    - /
    - '@ruby:->(f){f["type"].eql?("file")}'
aoc_tstsrc:
  tags:
    - ignore_fail
    - nodoc
  command:
    - aoc
    - files
    - delete
    - /testsrc
  post:
    - sleep TEMPORIZE_CREATE
aoc_tstsrcb:
  command:
    - aoc
    - files
    - mkdir
    - /testsrc
aoc_some_folder:
  tags:
    - ignore_fail
    - nodoc
  command:
    - aoc
    - files
    - delete
    - /some_folder
  post:
    - sleep TEMPORIZE_CREATE
aoc_some_folderb:
  command:
    - aoc
    - files
    - mkdir
    - /some_folder
  post:
    - sleep TEMPORIZE_CREATE
aoc_tstdst:
  tags:
    - ignore_fail
  depends_on:
    - aoc_some_folder
  command:
    - aoc
    - files
    - delete
    - /testdst
  post:
    - sleep TEMPORIZE_FILE
aoc_tstdstb:
  command:
    - aoc
    - files
    - browse
    - /
    - --node-cache=no
aoc_tstdstc:
  command:
    - aoc
    - files
    - modify
    - /some_folder
    - '@json:{"mount_point":false}'
aoc_tstdstd:
  command:
    - aoc
    - files
    - rename
    - /some_folder
    - testdst
aocfupl:
  depends_on:
    - aoc_tstsrc
  command:
    - aoc
    - files
    - upload
    - --to-folder=/testsrc
    - $(TST_ASC_LCL_PATH)
aocfuplb:
  command:
    - aoc
    - files
    - upload
    - --to-folder=/testsrc
    - $(TST_ASC_LCL_PATH)
    - $(TST_UTF_LCL_PATH)
aocftr:
  depends_on:
    - aocfupl
    - aoc_tstdst
  command:
    - aoc
    - files
    - transfer
    - push
    - /testsrc
    - --to-folder=/testdst
    - $(TST_ASC_FILENAME)
aocftrb:
  command:
    - aoc
    - files
    - upload
    - --to-folder=/testdst
    - $(TST_UTF_LCL_PATH)
aocndinf:
  depends_on:
    - aocftr
  tags:
    - save_output
  command:
    - aoc
    - files
    - node_info
    - /testdst
    - --format=json
    - --display=data
aocndinfb:
  depends_on:
    - aocndinf
  command:
    - aoc
    - files
    - upload
    - --workspace=@preset:aoc.other_workspace
    - --to-folder=@preset:aoc.other_folder
    - $(TST_ASC_FILENAME)
    - --transfer=node
    - --transfer-info=@json:$(read_value_from('aocndinf'))
