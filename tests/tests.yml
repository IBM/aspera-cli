# Tags:
# - nodoc : Do not include in documentation
# - ignore_fail : If it fails, ignore it, it's a cleanup
# - must_fail : Must fail case.
# - hide_fail : Do not show failure
# Shares ------------------------------------------------------
shares_health:
  tags:
    - must_fail
    - nodoc
  command:
    - shares
    - health
shares_health_bad:
  tags:
    - nodoc
  command:
    - shares
    - health
    - --url=https://wrong.example.com
shares_detect:
  command:
    - config
    - detect
    - "@preset:shares_admin.url"
    - shares
shares_wizard:
  command:
    - config
    - wizard
    - "@preset:shares_admin.url"
    - shares
    - --username=test
    - --password=test
shares_admin_1:
  command:
    - shares
    - admin
    - node
    - list
shares_admin_2:
  command:
    - shares
    - admin
    - group
    - all
    - list
shares_admin_3:
  command:
    - shares
    - admin
    - user
    - all
    - list
shares_admin_4:
  command:
    - shares
    - admin
    - user
    - local
    - list
shares_admin_5:
  command:
    - shares
    - admin
    - user
    - all
    - app_authorizations
    - "%username:@preset:shares_admin.username"
    - show
shares_admin_6:
  command:
    - shares
    - admin
    - user
    - all
    - app_authorizations
    - "%username:@preset:shares_admin.username"
    - modify
    - '@json:{"app_login":true}'
shares_admin_7:
  command:
    - shares
    - admin
    - user
    - all
    - share_permissions
    - "%username:@preset:shares_admin.username"
    - list
shares_admin_8:
  command:
    - shares
    - admin
    - user
    - all
    - share_permissions
    - "%username:@preset:shares_admin.username"
    - show
    - "%name:@preset:shares.share"
shares_admin_9:
  command:
    - shares
    - admin
    - user
    - saml
    - import
    - '@json:{"id":"the_id","name_id":"the_name"}'
shares_admin_10:
  tags:
    - hide_fail
  command:
    - shares
    - admin
    - user
    - ldap
    - add
    - the_name
shares_admin_11:
  command:
    - shares
    - admin
    - share
    - list
    - --fields=DEF,-status,status_message
shares_admin_12:
  command:
    - shares
    - admin
    - share
    - user_permissions
    - "%name:@preset:shares.share"
    - list
shares_1:
  command:
    - shares
    - files
    - browse
    - /
shares_2:
  command:
    - shares
    - files
    - upload
    - --to-folder=@preset:shares.share_folder
    - $(PATH_TST_ASC_LCL)
shares_3:
  depends_on:
    - shares_2
  command:
    - shares
    - files
    - download
    - --to-folder=$(TMP)
    - "@extend:@preset:shares.share_folder@/@preset:file.asc_name@"
shares_4:
  depends_on:
    - shares_3
  command:
    - shares
    - files
    - delete
    - "@extend:@preset:shares.share_folder@/@preset:file.asc_name@"
shares_5:
  depends_on:
    - shares_4
  command:
    - shares
    - files
    - upload
    - --to-folder=@preset:shares.share_folder
    - $(PATH_TST_ASC_LCL)
    - --transfer=httpgw
    - --preset=no_wss
    - --transfer-info=@json:@extend:{"url":"@preset:tst_httpgw.url@"}
shares_6:
  command:
    - shares
    - files
    - upload
    - faux:///testfile?1m
    - --to-folder=@preset:shares.share_folder
    - --transfer=httpgw
    - --preset=no_wss
    - --transfer-info=@json:@extend:{"url":"@preset:tst_httpgw.url@","synchronous":true,"api_version":"v1","upload_chunk_size":100000}
shares_6bis:
  command:
    - shares
    - files
    - upload
    - $(PATH_TST_LCL_FOLDER)
    - --to-folder=@preset:shares.share_folder
    - --transfer=httpgw
    - --preset=no_wss
    - --transfer-info=@json:@extend:{"url":"@preset:tst_httpgw.url@","synchronous":true,"api_version":"v1","upload_chunk_size":100000}
shares_7:
  depends_on:
    - shares_5
  command:
    - shares
    - files
    - download
    - --to-folder=$(TMP)
    - "@extend:@preset:shares.share_folder@/@preset:file.asc_name@"
    - "@extend:@preset:shares.share_folder@/@preset:file.asc_name@"
    - --transfer=httpgw
    - --preset=no_wss
    - --transfer-info=@json:@extend:{"url":"@preset:tst_httpgw.url@"}
shares_8:
  depends_on:
    - shares_7
  command:
    - shares
    - files
    - delete
    - "@extend:@preset:shares.share_folder@/@preset:file.asc_name@"
shares_9_prep:
  tags:
    - ignore_fail
    - nodoc
  command:
    - shares
    - files
    - delete
    - "@extend:@preset:shares.share_folder@/new_folder"
shares_9:
  depends_on:
    - shares_9_prep
  command:
    - shares
    - files
    - mkdir
    - "@extend:@preset:shares.share_folder@/new_folder"
shares_10:
  depends_on:
    - shares_9
  command:
    - shares
    - files
    - delete
    - "@extend:@preset:shares.share_folder@/new_folder"
shares_sync_prepare:
  tags:
    - ignore_fail
    - nodoc
  command:
    - shares
    - files
    - mkdir
    - "@extend:@preset:shares.share_folder@/synctst"
shares_sync_1:
  depends_on:
    - shares_sync_prepare
  command:
    - shares
    - files
    - sync
    - push
    - $(PATH_SHARES_SYNC)
    - --to-folder=@extend:@preset:shares.share_folder@/synctst
    - '@json:{"reset":true}'
shares_sync_2:
  depends_on:
    - shares_sync_1
  command:
    - shares
    - files
    - sync
    - push
    - $(PATH_SHARES_SYNC)
    - --to-folder=@extend:@preset:shares.share_folder@/synctst
# Server ------------------------------------------------------
serv_health:
  command:
    - server
    - health
    - transfer
    - --to-folder=@preset:server.upload_folder
serv_health_bad:
  tags:
    - nodoc
  command:
    - server
    - health
    - transfer
    - --url=ssh://wrong.example.com
serv_detect:
  command:
    - config
    - detect
    - "@preset:server_user.url"
    - server
serv_wizard:
  command:
    - config
    - wizard
    - "@preset:server_user.url"
    - server
    - --username=@preset:server_user.username
    - --password=@preset:server_user.password
serv_wizard2:
  tags:
    - nodoc
  command:
    - config
    - wizard
    - "@preset:server.address"
    - server
    - srv2
    - --username=@preset:server_user.username
    - --password=@preset:server_user.password
serv_browse:
  command:
    - server
    - browse
    - /
serv_mkdir:
  command:
    - server
    - mkdir
    - "@preset:server.inside_folder"
    - --logger=stdout
serv_error1:
  tags:
    - hide_fail
    - nodoc
  command:
    - server
    - --preset=server2_user
    - --password=wrong
    - upload
    - $(PATH_TST_ASC_LCL)
    - --transfer-info=@json:{"monitor":false,"resume":{"iter_max":0}}
serv_error2:
  tags:
    - hide_fail
    - nodoc
  command:
    - server
    - --preset=server2_user
    - --password=wrong
    - browse
    - /
    - --ssh-options=@json:{"number_of_password_prompts":0}
serv_error3:
  tags:
    - hide_fail
    - nodoc
  command:
    - server
    - -N
    - --url=foo://
    - ls
    - .
serv_error4:
  tags:
    - hide_fail
    - nodoc
  command:
    - server
    - -N
    - --url=@preset:node_user.url
    - upload
    - wrong
    - --ts=@json:{"token":"test"}
    - --transfer-info=@json:{"resume":{"iter_max":0}}
serv_error5:
  tags:
    - hide_fail
    - nodoc
  command:
    - server
    - -N
    - --url=@preset:node_user.url
    - upload
    - wrong
    - --transfer-info=@json:{"resume":{"iter_max":0}}
serv_ls_local:
  tags:
    - nodoc
  command:
    - -N
    - server
    - --url=local://
    - ls
    - .
serv_upload1:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - $(TST_MED_LCL_PATH)
    - --to-folder=@preset:server.inside_folder
    - --ts=@json:{"multi_session":3,"multi_session_threshold":1,"resume_policy":"none","target_rate_kbps":100000}
    - --transfer-info=@json:{"spawn_delay_sec":2.5,"multi_incr_udp":false}
    - --progress-bar=yes
serv_upload1b:
  depends_on:
    - serv_upload1
  command:
    - server
    - browse
    - "@extend:@preset:server.inside_folder@/$(TST_MED_FILENAME)"
serv_upload2:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - --src-type=pair
    - $(TST_MED_LCL_PATH)
    - "@extend:@preset:server.inside_folder@/other_name_2"
    - --notify-to=@preset:misc.email_external
    - --transfer-info=@json:{"ascp_args":["-l","100m"]}
serv_upload3_prep:
  tags:
    - ignore_fail
    - nodoc
  depends_on:
    - serv_mkdir
  command:
    - server
    - delete
    - "@extend:@preset:server.inside_folder@/other_name_3"
serv_upload3:
  depends_on:
    - serv_upload3_prep
  command:
    - server
    - upload
    - --src-type=pair
    - --sources=@json:@extend:["$(PATH_TST_ASC_LCL)","@preset:server.inside_folder@/other_name_3"]
    - --transfer-info.quiet=false
    - --progress=no
serv_upload4:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - --sources=@ts
    - --ts=@json:@extend:{"paths":[{"source":"$(PATH_TST_ASC_LCL)","destination":"@preset:server.inside_folder@/other_name_4"}]}
    - --transfer=transferd
serv_upload5:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - --src-type=pair
    - $(PATH_TST_ASC_LCL)
    - "@extend:@preset:server.upload_folder@/other_name_5"
    - --ts=@json:{"cipher":"aes-192-gcm","content_protection":"encrypt","content_protection_password":"my_secret_here","cookie":"biscuit","create_dir":true,"delete_before_transfer":false,"delete_source":false,"exclude_newer_than":"-1","exclude_older_than":"-10000","fasp_port":33001,"http_fallback":false,"multi_session":0,"overwrite":"diff+older","precalculate_job_size":true,"preserve_access_time":true,"preserve_creation_time":true,"rate_policy":"fair","resume_policy":"sparse_csum","symlink_policy":"follow"}
serv_sync_pull_args_reset:
  description: Sync using args syntax (reset)
  pre:
    - (TMP_SYNCS / 'serv_sync_pull_args').rmtree
    - (TMP_SYNCS / 'serv_sync_pull_args').mkdir
  tags:
    - nodoc
  depends_on:
    - serv_upload1
    - serv_upload2
    - serv_upload3
    - serv_upload5
  command:
    - server
    - sync
    - pull
    - "@preset:server.inside_folder"
    - --to-folder=$(TMP_SYNCS / 'serv_sync_pull_args')
    - '@json:@extend:{"instance":{"quiet":false},"sessions":[{"name":"serv_sync_pull_args","target_rate":"@preset:sync.bps@","reset":true}]}'
serv_sync_pull_args_status1:
  tags:
    - nodoc
  depends_on:
    - serv_sync_pull_args_reset
  command:
    - server
    - sync
    - admin
    - status
    - $(TMP_SYNCS / 'serv_sync_pull_args')
    - '@json:{"sessions":[{"name":"serv_sync_pull_args"}]}'
serv_sync_pull_args_sync2:
  tags:
    - nodoc
  depends_on:
    - serv_sync_pull_args_status1
  command:
    - server
    - sync
    - admin
    - meta
    - $(TMP_SYNCS / 'serv_sync_pull_args')
    - '@json:{"sessions":[{"name":"serv_sync_pull_args"}]}'
serv_sync_pull_args_counters:
  tags:
    - nodoc
  depends_on:
    - serv_sync_pull_args_sync2
  command:
    - config
    - sync
    - admin
    - counters
    - $(TMP_SYNCS / 'serv_sync_pull_args')
    - '@json:{"sessions":[{"name":"serv_sync_pull_args"}]}'
serv_sync_pull_conf_reset:
  pre:
    - (TMP_SYNCS / 'serv_sync_pull_conf').rmtree
    - (TMP_SYNCS / 'serv_sync_pull_conf').mkdir
  depends_on:
    - serv_sync_pull_args_counters
  command:
    - server
    - sync
    - pull
    - "@preset:server.inside_folder"
    - --to-folder=$(TMP_SYNCS / 'serv_sync_pull_conf')
    - '@json:@extend:{"name":"serv_sync_pull_conf","reset":true,"transport":{"target_rate":@preset:sync.bps@}}'
serv_sync_pull_conf_status_fail:
  depends_on:
    - serv_sync_pull_conf_reset
  tags:
    - hide_fail
    - nodoc
  command:
    - server
    - sync
    - admin
    - status
    - '@json:{"name":"serv_sync_pull_conf"}'
serv_sync_pull_conf_status:
  tags:
    - nodoc
  depends_on:
    - serv_sync_pull_conf_reset
  command:
    - server
    - sync
    - admin
    - status
    - $(TMP_SYNCS / 'serv_sync_pull_conf')
    - '@json:{"name":"serv_sync_pull_conf"}'
serv_sync_pull_conf_sync:
  depends_on:
    - serv_sync_pull_conf_reset
  command:
    - server
    - sync
    - pull
    - "@preset:server.inside_folder"
    - --to-folder=$(TMP_SYNCS / 'serv_sync_pull_conf')
    - '@json:@extend:{"name":"serv_sync_pull_conf"}'
serv_sync_pull_conf_status2:
  depends_on:
    - serv_sync_pull_conf_sync
  command:
    - server
    - sync
    - admin
    - status
    - $(TMP_SYNCS / 'serv_sync_pull_conf')
serv_sync_pull_conf_overview:
  depends_on:
    - serv_sync_pull_conf_sync
  command:
    - server
    - sync
    - admin
    - overview
    - $(TMP_SYNCS / 'serv_sync_pull_conf')
serv_sync_pull_conf_fileinfo:
  depends_on:
    - serv_sync_pull_conf_sync
  command:
    - server
    - sync
    - admin
    - file_info
    - $(TMP_SYNCS / 'serv_sync_pull_conf')
serv_upload_ex_list:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - --sources=@ts
    - --transfer-info=@json:{"ascp_args":["--file-list","$(PATH_FILE_LIST)"]}
    - --to-folder=@preset:server.inside_folder
serv_upload_ex_pair:
  depends_on:
    - serv_mkdir
  command:
    - server
    - upload
    - --sources=@ts
    - --transfer-info=@json:{"ascp_args":["--file-pair-list","$(PATH_FILE_PAIR_LIST)"]}
serv_md5:
  depends_on:
    - serv_upload1
  command:
    - server
    - md5sum
    - "@extend:@preset:server.inside_folder@/@preset:file.asc_name@"
serv_down_lcl:
  depends_on:
    - serv_upload1
  command:
    - server
    - download
    - "@extend:@preset:server.inside_folder@/@preset:file.asc_name@"
    - --to-folder=$(TMP)
    - --transfer-info=@json:{"wss":false,"resume":{"iter_max":1}}
serv_down_from_node:
  command:
    - server
    - download
    - "@preset:server.large_file"
    - --to-folder=@preset:server.upload_folder
    - --transfer=node
    - --ts.resume_policy=none
serv_down_from_node_fail:
  tags:
    - hide_fail
    - nodoc
  command:
    - server
    - download
    - file_does_not_exist.random
    - --to-folder=@preset:server.upload_folder
    - --transfer=node
serv_cp:
  depends_on:
    - serv_upload1
  command:
    - server
    - cp
    - "@extend:@preset:server.inside_folder@/@preset:file.asc_name@"
    - "@extend:@preset:server.upload_folder@/200KB.2"
serv_mv:
  depends_on:
    - serv_cp
  command:
    - server
    - mv
    - "@extend:@preset:server.upload_folder@/200KB.2"
    - "@extend:@preset:server.upload_folder@/to.delete"
serv_delete:
  depends_on:
    - serv_mv
  command:
    - server
    - delete
    - "@extend:@preset:server.upload_folder@/to.delete"
serv_cleanup1:
  depends_on:
    - serv_cp
    - serv_down_from_node
    - serv_down_lcl
    - serv_md5
  command:
    - server
    - delete
    - "@preset:server.inside_folder"
serv_info:
  command:
    - server
    - info
serv_du:
  command:
    - server
    - du
    - /
serv_df:
  command:
    - server
    - df
serv_health_xfer_nagios:
  command:
    - server
    - health
    - transfer
    - --to-folder=@preset:server.upload_folder
    - --format=nagios
serv_health_xfer_nagios_fail:
  tags:
    - must_fail
    - nodoc
  command:
    - server
    - health
    - transfer
    - --to-folder=/wrong
    - --format=nagios
serv_key_path:
  tags:
    - save_output
    - nodoc
  command:
    - config
    - ascp
    - info
    - --fields=ssh_private_rsa
serv_key:
  command:
    - server
    - browse
    - /
    - "--password=@none:"
    - --ssh-options=@json:{"number_of_password_prompts":0}
    - --ssh-keys=$(read_value_from 'serv_key_path')
serv_pr1:
  tags:
    - nodoc
  command:
    - server
    - upload
    - "faux:///test1?100m"
    - "faux:///test2?100m"
    - --to-folder=/Upload
    - --ts=@json:{"target_rate_kbps":1000000,"resume_policy":"none","precalculate_job_size":true}
    - --transfer-info=@json:{"quiet":false}
    - --progress=no
serv_pr2:
  tags:
    - nodoc
  command:
    - server
    - upload
    - "faux:///test1?100m"
    - "faux:///test2?100m"
    - --to-folder=/Upload
    - --ts=@json:{"target_rate_kbps":1000000,"resume_policy":"none","precalculate_job_size":true}
# Console ------------------------------------------------------
cons_health:
  command:
    - console
    - health
cons_health_bad:
  tags:
    - nodoc
  command:
    - console
    - health
    - --url=https://wrong.example.com
cons_detect:
  tags:
    - nodoc
  command:
    - config
    - detect
    - "@preset:console_admin.url"
cons_wizard:
  command:
    - config
    - wizard
    - "@preset:console_admin.url"
    - console
    - --preset=console_admin
cons_cur_lst:
  command:
    - console
    - transfer
    - current
    - list
    - --query=@json:{"filter1":"transfer_name","comp1":"contain","val1":"aoc"}
cons_cur_lst_ex:
  command:
    - console
    - transfer
    - current
    - list
    - --query.filter=(transfer_name contain aoc)
console_xfer_id:
  tags:
    - save_output
    - nodoc
  command:
    - console
    - transfer
    - current
    - list
    - --fields=id
    - --format=csv
cons_cur_show_one:
  depends_on:
    - console_xfer_id
  command:
    - console
    - transfer
    - current
    - show
    - $(read_value_from('console_xfer_id').split("\n").last)
cons_cur_show_one1:
  depends_on:
    - console_xfer_id
  command:
    - console
    - transfer
    - current
    - files
    - $(read_value_from('console_xfer_id').split("\n").last)
cons_cur_show_one2:
  tags:
    - ignore_fail
    - nodoc
  depends_on:
    - console_xfer_id
  command:
    - console
    - transfer
    - current
    - resume
    - $(read_value_from('console_xfer_id').split("\n").last)
cons_sma_lst:
  command:
    - console
    - transfer
    - smart
    - list
cons_sma_sta:
  tags:
    - ignore_fail
  command:
    - console
    - transfer
    - smart
    - sub
    - "@preset:console.smart_id"
    - '@json:@extend:{"source":{"paths":["@preset:console.smart_file@"]},"source_type":"user_selected"}'
# Node ------------------------------------------------------
# nodegen3
nd_health:
  command:
    - node
    - health
nd_health_bad:
  tags:
    - nodoc
  command:
    - node
    - health
    - --url=https://wrong.example.com
nd_detect:
  command:
    - config
    - detect
    - "@preset:node_user.url"
nd_wizard:
  command:
    - config
    - wizard
    - "@preset:node_user.url"
    - node
    - --username=test
    - --password=test
nd_info:
  command:
    - node
    - info
    - --fpac=function FindProxyForURL(url,host){return "DIRECT"}
nd_lic:
  command:
    - node
    - license
nd_det:
  command:
    - node
    - api_details
nd_tra:
  command:
    - node
    - transport
nd_bro:
  command:
    - node
    - browse
    - /
    - --log-level=trace2
nd_sea:
  command:
    - node
    - search
    - /
    - --query=@json:{"sort":"mtime"}
nd_spa:
  command:
    - node
    - space
    - /
nd_del_err:
  tags:
    - ignore_fail
    - nodoc
  command:
    - node
    - delete
    - /a_folder
nd_folder:
  depends_on:
    - nd_del_err
  command:
    - node
    - mkdir
    - "@extend:@preset:server.upload_folder@/a_folder"
nd_folder2:
  depends_on:
    - nd_folder
  command:
    - node
    - mklink
    - "@extend:@preset:server.upload_folder@/a_folder"
    - "@extend:@preset:server.upload_folder@/tdlink"
nd_folder3:
  depends_on:
    - nd_folder
  command:
    - node
    - mkfile
    - "@extend:@preset:server.upload_folder@/a_file1"
    - "hello world"
nd_folder4:
  depends_on:
    - nd_folder3
  command:
    - node
    - rename
    - "@preset:server.upload_folder"
    - a_file1
    - a_file
nd_folder5:
  depends_on:
    - nd_folder
    - nd_folder2
    - nd_folder3
    - nd_folder4
  command:
    - node
    - delete
    - "@list:@extend:,@preset:server.upload_folder@/a_folder,@preset:server.upload_folder@/tdlink,@preset:server.upload_folder@/a_file"
nd2:
  tags:
    - nodoc
  command:
    - node
    - upload
    - $(PATH_TST_ASC_LCL)
    - --to-folder=@preset:server.upload_folder
    - --ts=@json:{"target_rate_cap_kbps":10000}
nd2b:
  depends_on:
    - nd2
  command:
    - node
    - download
    - "@extend:@preset:server.upload_folder@/@preset:file.asc_name@"
    - --to-folder=$(TMP)
nd2c:
  depends_on:
    - nd2b
  command:
    - node
    - delete
    - "@extend:@preset:server.upload_folder@/@preset:file.asc_name@"
nd_slash:
  command:
    - node
    - slash
nd2_http:
  tags:
    - nodoc
  command:
    - node
    - upload
    - $(PATH_TST_ASC_LCL)
    - --to-folder=@preset:server.upload_folder
    - --ts=@json:{"target_rate_cap_kbps":10000}
nd2_httpb:
  depends_on:
    - nd2_http
  command:
    - node
    - cat
    - "@extend:@preset:server.upload_folder@/@preset:file.asc_name@"
nd2_httpc:
  depends_on:
    - nd2_httpb
  command:
    - node
    - delete
    - "@extend:@preset:server.upload_folder@/@preset:file.asc_name@"
nd_2_nd_xfer:
  command:
    - node
    - upload
    - --to-folder=@preset:server.upload_folder
    - --sources=@ts
    - --ts=@json:{"paths":[{"source":"/aspera-test-dir-small/10MB.2"}],"precalculate_job_size":true}
    - --transfer=node
    - --transfer-info=@json:@extend:{"url":"@preset:node_user.url@","username":"@preset:node_user.username@","password":"@preset:node_user.password@"}
nd_2_nd_xferb:
  depends_on:
    - nd_2_nd_xfer
  tags:
    - ignore_fail
    - nodoc
  command:
    - node
    - delete
    - "@extend:@preset:server.upload_folder@/10MB.2"
nd_service_clean:
  tags:
    - ignore_fail
    - nodoc
  command:
    - --preset=node_ak_adm
    - node
    - service
    - delete
    - service1
  post:
    - sleep TEMPORIZE_CREATE
nd_service_create:
  depends_on:
    - nd_service_clean
  command:
    - --preset=node_ak_adm
    - node
    - service
    - create
    - '@json:{"id":"service1","type":"WATCHD","run_as":{"user":"user1"}}'
nd_service_list:
  depends_on:
    - nd_service_create
  command:
    - --preset=node_ak_adm
    - node
    - service
    - list
  post:
    - sleep TEMPORIZE_CREATE
nd_service_delete:
  depends_on:
    - nd_service_list
  command:
    - --preset=node_ak_adm
    - node
    - service
    - delete
    - service1
nd_service_list_del:
  depends_on:
    - nd_service_delete
  command:
    - --preset=node_ak_adm
    - node
    - service
    - list
  post:
    - sleep TEMPORIZE_CREATE
nd_service_list_del2:
  depends_on:
    - nd_service_list_del
  command:
    - --preset=node_ak_adm
    - node
    - service
    - list
  post:
    - sleep TEMPORIZE_CREATE
nd_service_list_del3:
  depends_on:
    - nd_service_list_del2
  command:
    - --preset=node_ak_adm
    - node
    - service
    - list
nd_xfer_lst:
  command:
    - node
    - transfer
    - list
    - --query=@json:{"active_only":true}
nd_xfer_lstb:
  command:
    - node
    - transfer
    - list
    - --query=@json:{"reset":true}
    - --once-only=yes
nd_xfer_lst_once1:
  tags:
    - ignore_fail
    - nodoc
  depends_on:
    - nd_xfer_lstb
  command:
    - node
    - transfer
    - list
    - --once-only=yes
nd_xfer_lst_once2:
  tags:
    - ignore_fail
    - nodoc
  depends_on:
    - nd_xfer_lst_once1
  command:
    - node
    - transfer
    - list
    - --once-only=yes
nd_xfer_sess_lst:
  command:
    - node
    - transfer
    - sessions
nd_xfer_ops:
  tags:
    - nodoc
    - noblock
  command:
    - node
    - upload
    - --to-folder=@preset:server.upload_folder
    - --ts=@json:{"target_rate_kbps":1000,"resume_policy":"none"}
    - faux:///bigfile?10G
    - --progress=no
  post:
    - sleep 5
nd_xfer_id:
  tags:
    - save_output
    - nodoc
  command:
    - node
    - transfer
    - list
    - --query=@json:{"active_only":true,"count":1}
    - --fields=id
nd_xfer_ops3:
  command:
    - node
    - transfer
    - show
    - $(read_value_from 'nd_xfer_id')
nd_xfer_ops4:
  command:
    - node
    - transfer
    - modify
    - $(read_value_from 'nd_xfer_id')
    - '@json:{"target_rate_kbps":10000}'
nd_xfer_ops5:
  command:
    - node
    - transfer
    - show
    - $(read_value_from 'nd_xfer_id')
nd_xfer_ops6:
  command:
    - node
    - transfer
    - cancel
    - $(read_value_from 'nd_xfer_id')
nd_xfer_ops7:
  command:
    - node
    - transfer
    - bandwidth_average
nd_xfer_ops8:
  command:
    - node
    - transfer
    - sessions
node_basic_token:
  command:
    - node
    - basic_token
nd_browser:
  command:
    - node
    - asperabrowser
nd8:
  command:
    - node
    - upload
    - --username=@preset:aoc.ak_name
    - --password=@preset:aoc.ak_secret
    - $(PATH_TST_ASC_LCL)
nd_central_1:
  command:
    - node
    - central
    - session
    - list
nd_central_1b:
  command:
    - node
    - central
    - file
    - list
nd_central_1c:
  command:
    - node
    - central
    - file
    - modify
    - --validator=1
    - '@json:{"files":[]}'
nd_watch_1:
  command:
    - node
    - watch_folder
    - list
    - --preset=node_ak_adm
nd_watch_1b:
  tags:
    - hide_fail
    - nodoc
  command:
    - node
    - watch_folder
    - create
    - '@json:{"source":{"path":"/src1"},"target":{"path":"/dst1"}}'
    - --preset=node_ak_adm
nd_stream_1:
  command:
    - --preset=node_ak_adm
    - node
    - stream
    - list
nd_ak:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - list
nd_akb:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - node_info
    - /
nd_akc:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - browse
    - /
nd_akd:
  tags:
    - must_fail
    - nodoc
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - find
    - "@json:{}"
nd_ake:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - find
    - "@preset:aoc.test_folder"
    - |
      @ruby:->(f){f["name"].end_with?(".jpg")}
nd_akf:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - find
    - "@preset:aoc.test_folder"
    - '@re:\.jpg$'
nd_akg:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - find
    - "@preset:aoc.test_folder"
nd_ak_mkdir:
  tags:
    - ignore_fail
    - nodoc
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - delete
    - /tst_nd_ak
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mkdirb:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - mkdir
    - /tst_nd_ak
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mkfile:
  tags:
    - ignore_fail
    - nodoc
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - delete
    - /mkfile.txt
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mkfileb:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - mkfile
    - /mkfile.txt
    - hello world
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mklink:
  depends_on:
    - nd_ak_mkfile
  tags:
    - ignore_fail
    - nodoc
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - delete
    - /mklink.txt
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mklinkb:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - mklink
    - /mklink.txt
    - --query=@json:{"target":"/mkfile.txt","target_node_id":"123"}
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_mvdir:
  tags:
    - nodoc
  depends_on:
    - nd_ak_mkdir
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - browse
    - /
    - --node-cache=no
nd_ak_mvdirb:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - rename
    - /tst_nd_ak
    - test_nd_ak2
nd_ak_deldir:
  depends_on:
    - nd_ak_mvdir
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - delete
    - /test_nd_ak2
nd_ak3:
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - upload
    - 'faux:///test_nd_ak3?100k'
    - --default-ports=no
nd_ak3b:
  depends_on:
    - nd_ak3
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - download
    - test_nd_ak3
    - --to-folder=$(TMP)
nd_ak3c:
  tags:
    - hide_fail
    - nodoc
  depends_on:
    - nd_ak3
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - show
    - /test_nd_ak3
nd_ak3d:
  tags:
    - hide_fail
    - nodoc
  depends_on:
    - nd_ak3
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - thumbnail
    - /test_nd_ak3
nd_ak3e:
  depends_on:
    - nd_ak3b
    - nd_ak3c
    - nd_ak3d
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - delete
    - test_nd_ak3
nd_ak4:
  depends_on:
    - nd_ak3e
  command:
    - --preset=node_ak_adm
    - node
    - access_key
    - do
    - "@preset:aoc.ak_name"
    - show
    - "%id:1"
nd_ak_bearer_reset:
  tags:
    - ignore_fail
    - nodoc
  command:
    - node
    - -N
    - --preset=tst_node_preview
    - access_key
    - delete
    - "@preset:ak_creds.username"
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_bearer_create:
  depends_on:
    - nd_ak_bearer_reset
  command:
    - node
    - -N
    - --preset=tst_node_preview
    - access_key
    - create
    - '@json:@extend:{"id":"@preset:ak_creds.username@","secret":"@preset:ak_creds.password@","storage":{"type":"local","path":"/"}}'
  post:
    - sleep TEMPORIZE_CREATE
nd_ak_bearer_show:
  depends_on:
    - nd_ak_bearer_create
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - access_key
    - show
    - "%id:self"
nd_ak_bearer_set_key:
  depends_on:
    - nd_ak_bearer_create
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - access_key
    - set_bearer_key
    - self
    - "@file:@preset:file.private_key"
bearer_root_id:
  depends_on:
    - nd_ak_bearer_create
  tags:
    - save_output
    - nodoc
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - access_key
    - do
    - self
    - show
    - /
    - --fields=id
nd_ak_bearerf:
  depends_on:
    - nd_ak_bearer_create
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - access_key
    - do
    - self
    - permission
    - "%id:$(read_value_from 'bearer_root_id')"
    - create
    - '@json:{"access_type":"user","access_id":"666"}'
nd_ak_bearerg:
  depends_on:
    - nd_ak_bearerf
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - access_key
    - do
    - self
    - permission
    - /
    - show
    - 1
node_bearer_token:
  depends_on:
    - nd_ak_bearer_create
  tags:
    - save_output
    - nodoc
  command:
    - -N
    - --preset=tst_node_preview
    - --preset=ak_creds
    - node
    - bearer_token
    - "@file:@preset:file.private_key"
    - '@json:{"user_id":"666"}'
nd_ak_beareri:
  depends_on:
    - nd_ak_bearer_create
  command:
    - -N
    - node
    - --url=@preset:tst_node_preview.url
    - --password=Bearer $(read_value_from 'node_bearer_token')
    - --root-id=$(read_value_from 'bearer_root_id')
    - access_key
    - do
    - self
    - browse
    - /
nd_ak_bearer_del_perm:
  depends_on:
    - nd_ak_beareri
  command:
    - -N
    - --preset=tst_node_preview
    - node
    - --preset=ak_creds
    - access_key
    - do
    - self
    - permission
    - /
    - delete
    - 1
nd_ak_bearerk:
  depends_on:
    - nd_ak_bearer_del_perm
  command:
    - -N
    - --preset=tst_node_preview
    - node
    - access_key
    - delete
    - "@preset:ak_creds.username"
# AoC ------------------------------------------------------
aoc_detect:
  command:
    - config
    - detect
    - "@preset:aoc.org"
    - aoc
aoc_wizard:
  command:
    - config
    - tokens
    - flush
aoc_wizardb:
  command:
    - config
    - tokens
    - list
aoc_wizardc:
  command:
    - config
    - wizard
    - "@preset:aoc.org"
    - aoc
    - --key-path=@preset:file.private_key
    - --username=@preset:aoc.user_email
    - --use-generic-client=yes
aoc_wizard_2:
  tags:
    - hide_fail
    - nodoc
  command:
    - config
    - tokens
    - flush
aoc_wizard_2b:
  tags:
    - must_fail
    - nodoc
  command:
    - config
    - tokens
    - show
    - foobar
aoc_wizard_2c:
  depends_on:
    - aoc_wizard_2
  command:
    - config
    - wizard
    - "@preset:aoc.org"
    - aoc
    - mypreset
    - --key-path=@preset:file.private_key
    - --username=@preset:aoc.user_email
aoc_faspex_gateway:
  tags:
    - noblock
  command:
    - aoc
    - gateway
    - '@json:{"url":"https://localhost:12345/aspera/faspex"}'
aoc_faspex_gatewayb:
  tags:
    - nodoc
  command:
    - -N
    - faspex
    - --url=https://localhost:12345/aspera/faspex
    - --username=_unused_
    - --password=_unused_
    - --warn-insecure=yes
    - package
    - send
    - --delivery-info=@json:{"recipients":["laurent.martin.aspera@fr.ibm.com"],"title":"gateway aoc"}
    - faux:///test1?1m
  post:
    - stop_process 'aoc_faspex_gateway'
aocg1:
  command:
    - -N
    - aoc
    - servers
aocg1b:
  command:
    - -N
    - aoc
    - remind
    - --username=@preset:aoc.user_email
aocg2:
  command:
    - aoc
    - bearer_token
    - --display=data
    - --scope=user:all
aocg3:
  command:
    - aoc
    - organization
aocg3b:
  command:
    - aoc
    - organization
    - --format=image
    - --fields=background_image_url
    - --ui=text
aocg3c:
  command:
    - aoc
    - tier_restrictions
aocg4:
  command:
    - aoc
    - user
    - workspaces
    - list
aoc_user_profile:
  command:
    - aoc
    - user
    - profile
    - show
aocg6:
  command:
    - aoc
    - user
    - profile
    - modify
    - '@json:{"name":"dummy change"}'
aocuprefshow:
  command:
    - aoc
    - user
    - pref
    - show
aocuprefmod:
  command:
    - aoc
    - user
    - pref
    - modify
    - '@json:{"default_language":"en-us"}'
aocucontactlist:
  command:
    - aoc
    - user
    - contacts
    - list
aocg7:
  command:
    - aoc
    - packages
    - shared_inboxes
    - list
aocg7b:
  command:
    - aoc
    - packages
    - shared_inboxes
    - show
    - "%name:@preset:aoc.shared_inbox_name"
aocg8:
  command:
    - aoc
    - user
    - workspaces
    - current
aoc_webauth:
  command:
    - --preset=aoc_web
    - aoc
    - user
    - profile
    - show
aoc_webauthb:
  tags:
    - nodoc
  command:
    - --preset=aoc_web
    - aoc
    - user
    - profile
    - show
    - --http-options=@json:{"token_refresh_threshold":10000000000}
aocfbr:
  command:
    - aoc
    - files
    - browse
    - /
aocfbr1:
  command:
    - aoc
    - files
    - browse
    - "@preset:aoc.remote_folder"
aocfbr1b:
  command:
    - aoc
    - files
    - browse
    - "@extend:@preset:aoc.remote_folder@/"
aocfbr1c:
  command:
    - aoc
    - files
    - browse
    - "@preset:aoc.remote_file"
aocfbt:
  command:
    - aoc
    - files
    - bearer_token_node
    - /
    - --cache-tokens=no
aocffin:
  command:
    - aoc
    - files
    - find
    - /
aocffinb:
  command:
    - aoc
    - files
    - find
    - /
    - \.partial$
aocffinc:
  command:
    - aoc
    - files
    - find
    - /
    - '@ruby:->(f){f["type"].eql?("file")}'
aoc_tstsrc:
  tags:
    - ignore_fail
    - nodoc
  command:
    - aoc
    - files
    - delete
    - /testsrc
  post:
    - sleep TEMPORIZE_CREATE
aoc_tstsrcb:
  command:
    - aoc
    - files
    - mkdir
    - /testsrc
aoc_some_folder:
  tags:
    - ignore_fail
    - nodoc
  command:
    - aoc
    - files
    - delete
    - /some_folder
  post:
    - sleep TEMPORIZE_CREATE
aoc_some_folderb:
  tags:
    - nodoc
  command:
    - aoc
    - files
    - mkdir
    - /some_folder
  post:
    - sleep TEMPORIZE_CREATE
aoc_tstdst:
  tags:
    - ignore_fail
    - nodoc
  depends_on:
    - aoc_some_folder
  command:
    - aoc
    - files
    - delete
    - /testdst
  post:
    - sleep TEMPORIZE_FILE
aoc_tstdstb:
  tags:
    - nodoc
  command:
    - aoc
    - files
    - browse
    - /
    - --node-cache=no
aoc_tstdstc:
  command:
    - aoc
    - files
    - modify
    - /some_folder
    - '@json:{"mount_point":false}'
aoc_tstdstd:
  command:
    - aoc
    - files
    - rename
    - /some_folder
    - testdst
aocfupl:
  depends_on:
    - aoc_tstsrc
  command:
    - aoc
    - files
    - upload
    - --to-folder=/testsrc
    - $(PATH_TST_ASC_LCL)
aocfuplb:
  command:
    - aoc
    - files
    - upload
    - --to-folder=/testsrc
    - $(PATH_TST_ASC_LCL)
    - $(PATH_TST_UTF_LCL)
aocftr:
  depends_on:
    - aocfupl
    - aoc_tstdst
  command:
    - aoc
    - files
    - transfer
    - push
    - /testsrc
    - --to-folder=/testdst
    - "@preset:file.asc_name"
aocftrb:
  tags:
    - nodoc
  command:
    - aoc
    - files
    - upload
    - --to-folder=/testdst
    - $(PATH_TST_UTF_LCL)
aocndinf:
  depends_on:
    - aocftr
  tags:
    - save_output
    - nodoc
  command:
    - aoc
    - files
    - node_info
    - /testdst
    - --format=json
    - --display=data
aocndinfb:
  tags:
    - nodoc
  depends_on:
    - aocndinf
  command:
    - aoc
    - files
    - upload
    - --workspace=@preset:aoc.other_workspace
    - --to-folder=@preset:aoc.other_folder
    - "@preset:file.asc_name"
    - --transfer=node
    - --transfer-info=@json:$(read_value_from('aocndinf'))
aocfdel:
  depends_on:
    - aocftr
    - aocndinf
  command:
    - aoc
    - files
    - delete
    - /testsrc
aocfbearnode:
  command:
    - aoc
    - files
    - bearer
    - /
aocfdownd:
  tags:
  depends_on:
    - aocftr
  command:
    - aoc
    - files
    - download
    - --to-folder=$(TMP)
    - "@extend:testdst/@preset:file.asc_name@"
    - testdst/$(CONF_DATA['file']['utf_name'])
aocfdowndb:
  tags:
    - nodoc
  command:
    - aoc
    - files
    - download
    - --to-folder=$(TMP)
    - "@extend:testdst/@preset:file.asc_name@"
aocfdownc:
  depends_on:
    - aoc_tstdst
  pre:
    - PATH_DOWN_TST_ASC.delete rescue nil
    - system('killall asperaconnect') rescue nil
    - sleep 1
  command:
    - aoc
    - files
    - download
    - --transfer=connect
    - "@extend:testdst/@preset:file.asc_name@"
aocfdowna:
  depends_on:
    - aoc_tstdst
  pre:
    - PATH_DOWN_TST_ASC.delete rescue nil
  command:
    - aoc
    - files
    - download
    - --transfer=desktop
    - "@extend:testdst/@preset:file.asc_name@"
aocfhttpd:
  depends_on:
    - aocftr
  command:
    - aoc
    - files
    - cat
    - "@extend:testdst/@preset:file.asc_name@"
aocfv3inf:
  command:
    - aoc
    - files
    - v3
    - info
aoc_sync_pull_conf_parms:
  pre:
    - (TMP_SYNCS / 'aoc_sync_pull_conf_parms').rmtree
    - (TMP_SYNCS / 'aoc_sync_pull_conf_parms').mkdir
  command:
    - aoc
    - files
    - sync
    - pull
    - /testdst
    - --to-folder=$(TMP_SYNCS / 'aoc_sync_pull_conf_parms')
    - '@json:@extend:{"reset":true,"transport":{"target_rate":@preset:sync.bps@}}'
aoc_sync_pull_conf_parmsb:
  command:
    - aoc
    - files
    - sync
    - admin
    - status
    - $(TMP_SYNCS / 'aoc_sync_pull_conf_parms')
aoc_sync_conf_pull_params:
  pre:
    - (TMP_SYNCS / 'aoc_sync_conf_pull_params').rmtree
    - (TMP_SYNCS / 'aoc_sync_conf_pull_params').mkdir
  command:
    - aoc
    - files
    - sync
    - pull
    - /testdst
    - --to-folder=$(TMP_SYNCS / 'aoc_sync_conf_pull_params')
    - '@json:@extend:{"reset":true,"transport":{"target_rate":@preset:sync.bps@}}'
aoc_sync_conf_pull_paramsb:
  command:
    - aoc
    - files
    - sync
    - admin
    - status
    - $(TMP_SYNCS / 'aoc_sync_conf_pull_params')
aoc_file_id:
  depends_on:
    - aocftr
  tags:
    - save_output
    - nodoc
  command:
    - aoc
    - files
    - br
    - "@extend:testdst/@preset:file.asc_name@"
    - --fields=id
    - --format=csv
    - --display=data
aoc_file_id_2:
  depends_on:
    - aocftr
  command:
    - aoc
    - files
    - show
    - "%id:$(read_value_from 'aoc_file_id')"
aoc_file_id_3:
  depends_on:
    - aocftr
  command:
    - aoc
    - files
    - show
    - /
aoc_file_id_4:
  depends_on:
    - aocftr
  command:
    - aoc
    - files
    - show
    - "@extend:testdst/@preset:file.asc_name@"
aoc_file_id_5:
  tags:
    - ignore_fail
    - nodoc
  depends_on:
    - aocftr
  command:
    - aoc
    - files
    - mkdir
    - "@preset:aoc.test_folder"
aoc_file_id_6:
  tags:
    - nodoc
  depends_on:
    - aoc_file_id_5
  command:
    - aoc
    - files
    - upload
    - --to-folder=@preset:aoc.test_folder
    - --src-type=pair
    - "@preset:file.mpg"
    - video_file.mpg
  post:
    - puts 'waiting for preview'
    - sleep 60
aoc_file_id_7:
  tags:
    - nodoc
  depends_on:
    - aoc_file_id_5
  command:
    - aoc
    - files
    - upload
    - --to-folder=@preset:aoc.test_folder
    - --src-type=pair
    - "@preset:file.jpg"
    - image_file.jpg
aoc_file_id_8:
  depends_on:
    - aoc_file_id_5
  command:
    - aoc
    - files
    - permission
    - "@preset:aoc.test_folder"
    - list
aoc_file_id_9:
  depends_on:
    - aoc_file_id_6
  command:
    - aoc
    - files
    - thumbnail
    - "@extend:@preset:aoc.test_folder@/video_file.mpg"
aoc_file_id_10:
  depends_on:
    - aoc_file_id_6
  command:
    - aoc
    - files
    - thumbnail
    - "@extend:@preset:aoc.test_folder@/video_file.mpg"
    - --query=@json:{"text":true,"double":true}
aoc_file_id_11:
  tags:
    - nodoc
  depends_on:
    - aoc_file_id_6
  command:
    - aoc
    - files
    - thumbnail
    - "@extend:@preset:aoc.test_folder@/video_file.mpg"
    - --query=@json:{"text":true,"double":false}
aoc_file_id_12:
  env:
    TERM_PROGRAM: null
    LC_TERMINAL: null
  depends_on:
    - aoc_file_id_6
  command:
    - aoc
    - files
    - thumbnail
    - "@extend:@preset:aoc.test_folder@/video_file.mpg"
#	 aoc files modify @preset:aoc.test_folder
aocfpub:
  command:
    - -N
    - aoc
    - files
    - browse
    - /
    - --url=@preset:aoc.public_link_folder_no_pass
aocfpubb:
  command:
    - -N
    - aoc
    - files
    - browse
    - /
    - --url=@preset:aoc.public_link_folder_pass
    - --password=@preset:aoc.public_link_password
aocfpubc:
  command:
    - -N
    - aoc
    - files
    - upload
    - --to-folder=/
    - $(PATH_TST_ASC_LCL)
    - --url=@preset:aoc.public_link_folder_no_pass
aoc_lnk_priv:
  command:
    - aoc
    - files
    - browse
    - /
    - --url=@preset:aoc.private_link
aocshlk2:
  command:
    - aoc
    - files
    - short_link
    - /testdst
    - private
    - create
aocshlk3:
  command:
    - aoc
    - files
    - short_link
    - /testdst
    - public
    - create
aocshlk1:
  depends_on:
    - aocshlk2
    - aocshlk3
  command:
    - aoc
    - files
    - short_link
    - /testdst
    - private
    - list
aoc_pack_send1:
  command:
    - aoc
    - packages
    - send
    - '@json:@extend:{"name":"$(name) $(PACKAGE_TITLE_BASE)","recipients":["@preset:misc.email_internal@"],"note":"my
    - note"}'
    - $(PATH_TST_ASC_LCL)
aoc_pack_send2:
  command:
    - aoc
    - packages
    - send
    - '@json:@extend:{"name":"$(name) $(PACKAGE_TITLE_BASE)","recipients":["@preset:misc.email_external@"]}'
    - --new-user-option=@json:{"package_contact":true}
    - $(PATH_TST_ASC_LCL)
aocp2:
  command:
    - aoc
    - packages
    - list
package_id3:
  depends_on:
    - aoc_pack_send1
  tags:
    - save_output
    - wait_non_empty_output
    - nodoc
  command:
    - aoc
    - packages
    - list
    - --format=csv
    - --fields=id
    - --display=data
    - --query=@json:{"max":1,"archived":false,"has_content":true,"received":true,"completed":true}
aocp3b:
  depends_on:
    - aoc_pack_send1
  command:
    - aoc
    - packages
    - receive
    - $(read_value_from 'package_id3')
    - --to-folder=$(TMP)
aocp3c:
  depends_on:
    - aoc_pack_send1
  command:
    - aoc
    - packages
    - receive
    - $(read_value_from 'package_id3')
    - --to-folder=$(TMP)
    - /
    - --package-folder=name
aocp3d:
  depends_on:
    - aocp3c
  command:
    - aoc
    - packages
    - browse
    - $(read_value_from 'package_id3')
    - /
aocp4:
  command:
    - aoc
    - packages
    - receive
    - ALL
    - --once-only=yes
    - --to-folder=$(TMP)
    - --lock-port=12345
aocp5:
  command:
    - aoc
    - organization
    - -N
    - --url=@preset:aoc.public_link_recv_from_aoc_user
aocp_send_pub_sh:
  command:
    - -N
    - aoc
    - packages
    - send
    - '@json:{"name":"$(name) $(PACKAGE_TITLE_BASE)"}'
    - $(PATH_TST_ASC_LCL)
    - --url=@preset:aoc.public_link_send_shared_inbox
aocp_send_pub_usr:
  command:
    - -N
    - aoc
    - packages
    - send
    - '@json:{"name":"$(name) $(PACKAGE_TITLE_BASE)"}'
    - $(PATH_TST_ASC_LCL)
    - --url=@preset:aoc.public_link_send_aoc_user
    - --password=@preset:aoc.public_link_send_use_pass
aocp_recv_init:
  command:
    - aoc
    - packages
    - receive
    - INIT
    - --once-only=yes
    - --query=@json:@extend:{"dropbox_name":"@preset:aoc.shared_inbox_name@"}
aocp_send_shbx:
  depends_on:
    - aocp_recv_init
  command:
    - aoc
    - packages
    - send
    - --workspace=@preset:aoc.workspace_shared_inbox
    - '@json:@extend:{"name":"$(name) $(PACKAGE_TITLE_BASE)","recipients":["@preset:aoc.shared_inbox_name@"]}'
    - $(PATH_TST_ASC_LCL)
aocp_send_sh_meta_long:
  depends_on:
    - aocp_recv_init
  command:
    - aoc
    - packages
    - send
    - --workspace=@preset:aoc.workspace_shared_inbox
    - --validate-metadata=yes
    - '@json:@extend:{"name":"$(name) $(PACKAGE_TITLE_BASE)","recipients":["@preset:aoc.shared_inbox_meta@"],"metadata":[{"input_type":"single-text","name":"Project Id","values":["123"]},{"input_type":"single-dropdown","name":"Type","values":["Opt2"]},{"input_type":"multiple-checkbox","name":"CheckThose","values":["Check1","Check2"]},{"input_type":"date","name":"Optional Date","values":["2021-01-13T15:02:00.000Z"]}]}'
    - $(PATH_TST_ASC_LCL)
aocp_send_sh_meta_short:
  depends_on:
    - aocp_recv_init
  command:
    - aoc
    - packages
    - send
    - --workspace=@preset:aoc.workspace_shared_inbox
    - --validate-metadata=yes
    - '@json:@extend:{"name":"$(name) $(PACKAGE_TITLE_BASE)","recipients":["@preset:aoc.shared_inbox_meta@"],"metadata":{"Project Id":"456","Type":"Opt2","CheckThose":["Check1","Check2"],"Optional Date":"2021-01-13T15:02:00.000Z"}}'
    - $(PATH_TST_ASC_LCL)
aocp_send_sh_meta_short2:
  $comment: Fails because missing metadata "Project Id"
  tags:
    - hide_fail
    - nodoc
  depends_on:
    - aocp_recv_init
  command:
    - aoc
    - packages
    - send
    - --workspace=@preset:aoc.workspace_shared_inbox
    - --validate-metadata=yes
    - '@json:@extend:{"name":"$(name) $(PACKAGE_TITLE_BASE)","recipients":["@preset:aoc.shared_inbox_meta@"],"metadata":{"Type":"Opt2","CheckThose":["Check1","Check2"],"Optional Date":"2021-01-13T15:02:00.000Z"}}'
    - $(PATH_TST_ASC_LCL)
aocp_recv_shbx:
  depends_on:
    - aocp_send_shbx
    - aocp_send_sh_meta_long
    - aocp_send_sh_meta_short
  command:
    - aoc
    - packages
    - receive
    - ALL
    - --once-only=yes
    - --to-folder=$(TMP)
    - --lock-port=12345
    - --query=@json:@extend:{"dropbox_name":"@preset:aoc.shared_inbox_name@","archived":false,"received":true,"has_content":true,"exclude_dropbox_packages":false,"include_draft":false}
    - --ts=@json:{"resume_policy":"sparse_csum","target_rate_kbps":50000}
aocp_list_shbx:
  depends_on:
    - aocp_send_shbx
    - aocp_send_sh_meta_long
    - aocp_send_sh_meta_short
  command:
    - aoc
    - packages
    - list
    - --query=@json:@extend:{"dropbox_name":"@preset:aoc.shared_inbox_name@","sort":"-received_at","archived":false,"received":true,"has_content":true,"exclude_dropbox_packages":false}
aoc_adm_authp_lst:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - auth_providers
    - list
aoc_adm_authp_lst2:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - subscription
    - account
aoc_adm_authp_lst3:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - subscription
    - usage
aoc_adm_authp_lst4:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - subscription
    - usage
    - MONTH
aoc_adm_ws_lst:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - workspace
    - list
aoc_adm_ws_lst2:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - workspace
    - dropbox
    - "%name:@preset:aoc.other_workspace"
    - list
aoc_adm_ws_lst3:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - workspace
    - shared_folder
    - "%name:@preset:aoc.other_workspace"
    - list
shared_folder_id:
  tags:
    - save_output
    - nodoc
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - workspace
    - shared_folder
    - "%name:@preset:aoc.other_workspace"
    - list
    - --query.max=1
    - --fields=id
aoc_adm_ws_lst5:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - workspace
    - shared_folder
    - "%name:@preset:aoc.other_workspace"
    - member
    - $(read_value_from 'shared_folder_id')
    - list
aoc_adm_nd_events:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - --secret=@preset:aoc.ak_secret
    - v3
    - events
aoc_adm_ak_create:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - --secret=@preset:aoc.ak_secret
    - mkdir
    - /folder_sub
aoc_adm_ak_browse:
  depends_on:
    - aoc_adm_ak_create
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - --secret=@preset:aoc.ak_secret
    - browse
    - /folder_sub
    - --node-cache=no
aoc_adm_ak_sub_ak:
  depends_on:
    - aoc_adm_ak_create
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - --secret=@preset:aoc.ak_secret
    - v3
    - access_key
    - create
    - '@json:{"id":"testsub1","storage":{"path":"/folder_sub"}}'
aoc_adm_ak_del:
  depends_on:
    - aoc_adm_ak_create
    - aoc_adm_ak_browse
    - aoc_adm_ak_sub_ak
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - --secret=@preset:aoc.ak_secret
    - v3
    - access_key
    - delete
    - testsub1
aoc_adm_ak_dir_del:
  depends_on:
    - aoc_adm_ak_del
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - --secret=@preset:aoc.ak_secret
    - delete
    - /folder_sub
aoc_adm_nd_br:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - --secret=@preset:aoc.ak_secret
    - browse
    - /
aoc_adm_nd_mkdir_prep:
  tags:
    - ignore_fail
    - nodoc
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - --secret=@preset:aoc.ak_secret
    - delete
    - /folder1
    - --node-cache=no
  post:
    - sleep 4
aoc_adm_nd_mkdir:
  depends_on:
    - aoc_adm_nd_mkdir_prep
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - --secret=@preset:aoc.ak_secret
    - mkdir
    - /folder1
  post:
    - sleep TEMPORIZE_CREATE
aoc_adm_nd_brse:
  tags:
    - nodoc
  depends_on:
    - aoc_adm_nd_mkdir
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - --secret=@preset:aoc.ak_secret
    - browse
    - /
    - --node-cache=no
aoc_adm_nd_rmdir:
  depends_on:
    - aoc_adm_nd_mkdir
    - aoc_adm_nd_brse
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - --secret=@preset:aoc.ak_secret
    - delete
    - /folder1
aoc_adm_wsm_lst:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - workspace_membership
    - list
    - --fields=ALL
    - --query=@json:{"page":1,"per_page":50,"embed":"member","inherited":false,"workspace_id":11363,"sort":"name"}
aoc15:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - analytics
    - transfers
    - organization
    - --query=@json:{"status":"completed","direction":"receive","limit":2}
    - --notify-to=@preset:misc.email_external
    - |
      --notify-template=@ruby:%Q{From: <%=from_name%> <<%=from_email%>>\nTo: <<%=to%>>\nSubject: <%=ev["files_completed"]%> files received\n\n<%=ev.to_yaml%>}
aoc_transfer_id:
  tags:
    - save_output
    - nodoc
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - analytics
    - transfers
    - organization
    - --query=@json:{"status":"completed","direction":"receive","limit":1}
    - --fields=uuid
aoc_ana_files:
  depends_on:
    - aoc_transfer_id
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - analytics
    - files
    - organization
    - ''
    - $(read_value_from 'aoc_transfer_id')
aoc16:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - analytics
    - transfers
    - users
    - --once-only=yes
#	 --preset=aoc_admin aoc admin analytics transfers nodes
aoc_adm_res_01:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - self
    - show
aoc_adm_res_01b:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - organization
    - show
aoc_adm_res_01c:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - user
    - list
aoc_adm_res_01d:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - user
    - modify
    - "@extend:%name:@preset:aoc.user_email@"
    - '@json:{"deactivated":false}'
aoc_adm_res_02:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - group
    - list
aoc_adm_res_02b:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - client
    - list
aoc_adm_res_02c:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - contact
    - list
aoc_adm_res_02d:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - dropbox
    - list
aoc_adm_res_03:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - list
aoc_adm_res_03b:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - operation
    - list
aoc_adm_res_03c:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - package
    - list
    - --http-options=@json:{"read_timeout":120.0}
aoc_adm_res_03d:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - saml_configuration
    - list
aoc_adm_res_04:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - dropbox_membership
    - list
aoc_adm_res_04b:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - workspace_membership
    - list
aoc_adm_res_04c:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - short_link
    - list
aoc_adm_res_05:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - application
    - list
aoc_adm_res_05b:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - client_access_key
    - list
aoc_adm_res_05c:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - kms_profile
    - list
aoccltreg:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - client_registration_token
    - create
    - '@json:{"data":{"name":"test_client_reg1","client_subject_scopes":["alee","aejd"],"client_subject_enabled":true}}'
aoccltregb:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - client_registration_token
    - list
client_reg_id:
  tags:
    - save_output
    - nodoc
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - client_registration_token
    - list
    - --select=@json:{"data.name":"test_client_reg1"}
    - --fields=id
    - --display=data
    - --query.max=1
aoccltregd:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - client_registration_token
    - delete
    - $(read_value_from 'client_reg_id')
aocadmndcr:
  tags:
    - ignore_fail
    - nodoc
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - delete
    - test_shared_folder
    - --node-cache=no
aocadmndcrb:
  tags:
    - ignore_fail
    - nodoc
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - browse
    - test_shared_folder
    - --node-cache=no
aocadmndcrc:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - mkdir
    - test_shared_folder
aocadmndcrd:
  tags:
    - nodoc
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - browse
    - test_shared_folder
    - --node-cache=no
aocadmndsh1:
  depends_on:
    - aocadmndcr
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - perm
    - test_shared_folder
    - create
    - '@json:{"with":"","as":"other_name_shared"}'
    - --workspace=@preset:aoc.workspace_shared_inbox
aocadmndsh2:
  depends_on:
    - aocadmndsh1
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - perm
    - test_shared_folder
    - create
    - '@json:@extend:{"with":"@preset:aoc.user_email@","as":"other_name_shared"}'
    - --workspace=@preset:aoc.workspace_shared_inbox
aocadmndsh3:
  depends_on:
    - aocadmndsh1
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - perm
    - test_shared_folder
    - create
    - '@json:@extend:{"with":"@preset:aoc.user_group@","as":"other_name_shared"}'
    - --workspace=@preset:aoc.workspace_shared_inbox
aocadmndsh4:
  depends_on:
    - aocadmndsh2
    - aocadmndsh3
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - node
    - do
    - "%name:@preset:aoc.node_name"
    - delete
    - test_shared_folder
aocat4:
  command:
    - aoc
    - admin
    - ats
    - cluster
    - list
aocat5:
  command:
    - aoc
    - admin
    - ats
    - cluster
    - clouds
aocat6:
  command:
    - aoc
    - admin
    - ats
    - cluster
    - show
    - --cloud=aws
    - --region=eu-west-1
aocat7:
  command:
    - aoc
    - admin
    - ats
    - cluster
    - show
    - 1f412ae7-869a-445c-9c05-02ad16813be2
# see https://developer.ibm.com/api/view/aspera-prod:ibm-aspera:title-IBM_Aspera#113433
aocat8:
  tags:
    - ignore_fail
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - ats
    - access_key
    - delete
    - ak1ibmcloud
aocat8b:
  depends_on:
    - aocat8
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - ats
    - access_key
    - create
    - --cloud=softlayer
    - --region=@preset:icos.region
    - '@json:@extend:{"id":"ak1ibmcloud","secret":"@preset:misc.secret_here@","name":"my test key","storage":{"type":"ibm-s3","bucket":"@preset:icos.bucket@","credentials":{"access_key_id":"@preset:icos.access_key@","secret_access_key":"@preset:icos.secret_key@"},"path":"/"}}'
aocat9:
  tags:
    - hide_fail
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - ats
    - access_key
    - create
    - --cloud=aws
    - --region=@preset:aws.region
    - '@json:@extend:{"id":"ak_aws_aoc","name":"my test key AWS","storage":{"type":"aws_s3","bucket":"@preset:aws.bucket@","credentials":{"access_key_id":"@preset:aws.access_key@","secret_access_key":"@preset:aws.secret_key@"},"path":"/"}}'
aocat10:
  tags:
    - hide_fail
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - ats
    - access_key
    - list
    - --fields=name,id
aocat11:
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - ats
    - access_key
    - node
    - ak1ibmcloud
    - --secret=@preset:misc.secret_here
    - browse
    - /
aocat13:
  tags:
    - hide_fail
    - nodoc
  command:
    - --preset=aoc_admin
    - aoc
    - admin
    - ats
    - access_key
    - delete
    - ak1ibmcloud
aocauto1:
  command:
    - --preset=aoc_admin
    - aoc
    - automation
    - workflow
    - create
    - '@json:{"name":"test_workflow"}'
wf_id:
  tags:
    - save_output
  depends_on:
    - aocauto1
  command:
    - --preset=aoc_admin
    - aoc
    - automation
    - workflow
    - list
    - --select=@json:{"name":"test_workflow"}
    - --fields=id
aocauto2:
  command:
    - --preset=aoc_admin
    - aoc
    - automation
    - workflow
    - list
aocauto2b:
  command:
    - --preset=aoc_admin
    - aoc
    - automation
    - workflow
    - list
    - --query=@json:{"show_org_workflows":"true"}
    - --scope=admin:all
aocauto3:
  $comment: Verify what it should do, and not fail.
  depends_on:
    - wf_id
  tags:
    - ignore_fail
  command:
    - --preset=aoc_admin
    - aoc
    - automation
    - workflow
    - action
    - $(read_value_from 'wf_id')
    - create
    - '@json:{"name":"toto"}'
#		| tee action.info
#	sed -nEe 's/^\| id +\| ([^ ]+) +\|/\1/p' action.info > tmp_action_id.txt
#	rm -f action.info
#	rm -f tmp_action_id.txt
aocauto10:
  depends_on:
    - wf_id
  command:
    - --preset=aoc_admin
    - aoc
    - automation
    - workflow
    - delete
    - $(read_value_from 'wf_id')
orch_health:
  command:
    - orchestrator
    - health
orch_health_bad:
  tags:
    - hide_fail
    - nodoc
  command:
    - orchestrator
    - health
    - --url=https://wrong.url
    - --format=nagios
orch_detect:
  tags:
    - nodoc
  command:
    - config
    - detect
    - "@preset:orch_user.url"
orch_wizard:
  command:
    - config
    - wizard
    - "@preset:orch_user.url"
    - orchestrator
    - --username=test
    - --password=test
orch_info:
  command:
    - orchestrator
    - info
orch_wf_list:
  command:
    - orchestrator
    - workflow
    - list
orch_wf_sta:
  command:
    - orchestrator
    - workflow
    - status
    - ALL
orch_wf_inp:
  command:
    - orchestrator
    - workflow
    - inputs
    - "@preset:orch.workflow_id"
orch_wf_sti:
  command:
    - orchestrator
    - workflow
    - status
    - "@preset:orch.workflow_id"
orch_wf_str1:
  command:
    - orchestrator
    - workflow
    - start
    - "@preset:orch.workflow_id"
    - '@json:{"Param":"world !"}'
orch_wf_str2:
  command:
    - orchestrator
    - workflow
    - start
    - "@preset:orch.workflow_id"
    - '@json:{"Param":"world !"}'
    - --result=ResultStep:Complete_status_message
orch_plugins:
  command:
    - orchestrator
    - plugins
orch_processes:
  command:
    - orchestrator
    - processes
orch_wf_details:
  command:
    - orchestrator
    - workflow
    - details
    - "@preset:orch.workflow_id"
orch_wf_detailsb:
  command:
    - orchestrator
    - workflow
    - export
    - "@preset:orch.workflow_id"
at4:
  command:
    - ats
    - cluster
    - list
at5:
  command:
    - ats
    - cluster
    - clouds
at6:
  command:
    - ats
    - cluster
    - show
    - --cloud=aws
    - --region=eu-west-1
at7:
  command:
    - ats
    - cluster
    - show
    - 1f412ae7-869a-445c-9c05-02ad16813be2
at2:
  command:
    - ats
    - api_key
    - instances
at1:
  command:
    - ats
    - api_key
    - list
at3:
  command:
    - ats
    - api_key
    - create
at8_prep:
  tags:
    - ignore_fail
    - nodoc
  command:
    - ats
    - access_key
    - delete
    - ak2ibmcloud
  post:
    - sleep TEMPORIZE_CREATE
at8b:
  depends_on:
    - at8_prep
  command:
    - ats
    - access_key
    - create
    - --cloud=softlayer
    - --region=@preset:icos.region
    - '@json:@extend:{"id":"ak2ibmcloud","secret":"@preset:misc.secret_here@","name":"my test key","storage":{"type":"ibm-s3","bucket":"@preset:icos.bucket@","credentials":{"access_key_id":"@preset:icos.access_key@","secret_access_key":"@preset:icos.secret_key@"},"path":"/"}}'
  post:
    - sleep TEMPORIZE_CREATE
at8c:
  depends_on:
    - at8b
  command:
    - ats
    - access_key
    - show
    - ak2ibmcloud
at8d:
  depends_on:
    - at8b
  command:
    - ats
    - access_key
    - entitlement
    - ak2ibmcloud
at9:
  tags:
    - hide_fail
  command:
    - ats
    - access_key
    - create
    - --cloud=aws
    - --region=@preset:aws.region
    - '@json:@extend:{"id":"ak_aws","name":"my test key AWS","storage":{"type":"aws_s3","bucket":"@preset:aws.bucket@","credentials":{"access_key_id":"@preset:aws.access_key@","secret_access_key":"@preset:aws.secret_key@"},"path":"/"}}'
at10:
  tags:
    - hide_fail
  command:
    - ats
    - access_key
    - list
    - --fields=name,id
at11:
  command:
    - ats
    - access_key
    - node
    - ak2ibmcloud
    - browse
    - /
    - --secret=@preset:misc.secret_here
at12:
  command:
    - ats
    - access_key
    - cluster
    - ak2ibmcloud
    - --secret=@preset:misc.secret_here
at13:
  tags:
    - hide_fail
  command:
    - ats
    - access_key
    - delete
    - ak2ibmcloud
at14:
  tags:
    - hide_fail
    - nodoc
  command:
    - ats
    - access_key
    - delete
    - ak_aws
nd_sync_pull_conf:
  pre:
    - (TMP_SYNCS / 'nd_sync_pull_conf').rmtree
    - (TMP_SYNCS / 'nd_sync_pull_conf').mkdir
  command:
    - node
    - sync
    - pull
    - /aspera-test-dir-tiny
    - --to-folder=$(TMP_SYNCS / 'nd_sync_pull_conf')
    - '@json:{"reset":true}'
nd_sync_pull_confb:
  depends_on:
    - nd_sync_pull_conf
  command:
    - node
    - sync
    - admin
    - status
    - $(TMP_SYNCS / 'nd_sync_pull_conf')
nd_sync_v2:
  pre:
    - (TMP_SYNCS / 'nd_sync_v2').rmtree
    - (TMP_SYNCS / 'nd_sync_v2').mkdir
  command:
    - node
    - sync
    - pull
    - /aspera-test-dir-tiny
    - --to-folder=$(TMP_SYNCS / 'nd_sync_v2')
    - '@json:{"name":"my_sync_session_name","reset":true}'
nd_sync_v2b:
  depends_on:
    - nd_sync_v2
  command:
    - node
    - sync
    - admin
    - status
    - $(TMP_SYNCS / 'nd_sync_v2')
nd_async_list:
  command:
    - node
    - async
    - list
nd_async_show:
  command:
    - node
    - async
    - show
    - ALL
nd_async_showb:
  depends_on:
    - nd_sync_v2
  command:
    - node
    - async
    - show
    - "%name:my_sync_session_name"
nd_async_cntr:
  depends_on:
    - nd_sync_v2
  command:
    - node
    - async
    - counters
    - "%name:my_sync_session_name"
nd_async_bw:
  depends_on:
    - nd_sync_v2
  command:
    - node
    - async
    - bandwidth
    - "%name:my_sync_session_name"
nd_async_files:
  depends_on:
    - nd_sync_v2
  command:
    - node
    - async
    - files
    - "%name:my_sync_session_name"
nd_async_filesb:
  depends_on:
    - nd_sync_v2
  command:
    - node
    - async
    - files
    - "%name:my_sync_session_name"
    - --once-only=yes
nd_async_del:
  depends_on:
    - nd_async_showb
    - nd_async_cntr
    - nd_async_bw
    - nd_async_files
    - nd_async_filesb
  command:
    - node
    - async
    - delete
    - ALL
sync_create_prep1:
  tags:
    - ignore_fail
    - nodoc
  command:
    - server
    - --preset=server2_user
    - delete
    - "@preset:sync.remote_path"
sync_create_prep2:
  tags:
    - nodoc
  depends_on:
    - sync_create_prep1
  command:
    - --preset=server2_user
    - server
    - mkdir
    - "@preset:sync.remote_path"
sync_create_prep3:
  tags:
    - ignore_fail
    - nodoc
  command:
    - node
    - delete
    - "@preset:sync.local_path"
sync_create_prep4:
  tags:
    - nodoc
  depends_on:
    - sync_create_prep3
  command:
    - node
    - mkdir
    - "@preset:sync.local_path"
sync_create_prep5:
  depends_on:
    - sync_create_prep4
  command:
    - node
    - upload
    - 'faux:///testfile1?1m'
    - --to-folder=@preset:sync.local_path
sync_create:
  depends_on:
    - sync_create_prep2
    - sync_create_prep5
  command:
    - node
    - ssync
    - create
    - '@json:@extend:{"configuration":{"name":"my_node_sync","local":{"path":"@preset:sync.local_path_real@"},"remote":{"host":"@preset:server2_info.host@","port":@preset:server2_info.port@,"user":"@preset:server_user.username@","pass":"@preset:server_user.password@","path":"@preset:sync.remote_path@"}}}'
sync_create_check:
  depends_on:
    - sync_create
  command:
    - node
    - ssync
    - list
sync_start_1:
  depends_on:
    - sync_create_check
  command:
    - node
    - ssync
    - start
    - "%name:my_node_sync"
sync_check_1:
  depends_on:
    - sync_start_1
  command:
    - node
    - ssync
    - show
    - "%name:my_node_sync"
  post:
    - sleep 30
sync_other_a:
  depends_on:
    - sync_check_1
  command:
    - node
    - ssync
    - bandwidth
    - "%name:my_node_sync"
sync_other_b:
  depends_on:
    - sync_check_1
  command:
    - node
    - ssync
    - counters
    - "%name:my_node_sync"
sync_other_c:
  depends_on:
    - sync_check_1
  command:
    - node
    - ssync
    - files
    - "%name:my_node_sync"
sync_other_d:
  depends_on:
    - sync_check_1
  command:
    - node
    - ssync
    - state
    - "%name:my_node_sync"
sync_other_e:
  depends_on:
    - sync_check_1
  command:
    - node
    - ssync
    - stop
    - "%name:my_node_sync"
sync_other_f:
  depends_on:
    - sync_check_1
  command:
    - node
    - ssync
    - summary
    - "%name:my_node_sync"
sync_other_delete:
  depends_on:
    - sync_other_a
    - sync_other_b
    - sync_other_c
    - sync_other_d
    - sync_other_e
    - sync_other_f
  command:
    - node
    - ssync
    - delete
    - "%name:my_node_sync"
sync_other_delete_fail:
  tags:
    - hide_fail
    - nodoc
  command:
    - node
    - ssync
    - delete
    - not_exist
conf_detect:
  command:
    - config
    - detect
    - "@preset:node_user.url"
conf_detectb:
  tags:
    - hide_fail
    - nodoc
  command:
    - config
    - detect
    - https://www.ibm.com
conf_ascp_show:
  command:
    - config
    - ascp
    - show
conf_ascp_spec:
  command:
    - config
    - ascp
    - spec
conf_sync_spec:
  command:
    - config
    - sync
    - spec
conf_sync_trans:
  tags:
    - nodoc
  command:
    - config
    - sync
    - translate
    - --format=jsonpp
    - --show-secrets=yes
    - --
    - -L
    - /optlogs/
    - -N
    - transfer_test
    - -x
    - -P
    - 33001
    - -k
    - md5-sparse
    - -i
    - /root/.ssh/id_rsa_eudemo
    - -b
    - /opt/async_db
    - -d
    - /opt/source/
    - -C
    - --scan-interval=30
    - --transfer-threads=1
    - --pending-max=2000
    - -r
    - /tmp/dest/
    - --user
    - root
    - --host
    - 1.2.3.4
    - -R
    - /tmp/logs/
    - -B
    - /opt/async_db
    - -l
    - 1000
    - --cooloff=5
    - --preserve-uid
    - --preserve-gid
    - -K
    - push
conf_ascp_schema:
  command:
    - config
    - ascp
    - schema
    - --format=jsonpp
conf_ascp_errors:
  command:
    - config
    - ascp
    - errors
conf_ascp_2:
  command:
    - config
    - ascp
    - products
    - list
conf_ascp_prod:
  tags:
    - tmp_conf
  command:
    - config
    - ascp
    - products
    - use
    - 'IBM Aspera Connect'
conf_ascp_use:
  tags:
    - tmp_conf
    - nodoc
  command:
    - config
    - ascp
    - use
    - $(`which ascp`)
conf_ascp_3:
  command:
    - config
    - ascp
    - connect
    - list
conf_ascp_4:
  command:
    - config
    - ascp
    - connect
    - info
    - Aspera Connect for Windows
conf_ascp_5:
  command:
    - config
    - ascp
    - connect
    - version
    - Aspera Connect for Windows
    - list
conf_ascp_6:
  command:
    - config
    - ascp
    - connect
    - version
    - Aspera Connect for Windows
    - download
    - Windows Installer
    - --to-folder=$(TMP)
conf_ascp_6b:
  command:
    - config
    - ascp
    - connect
    - version
    - Aspera Connect for Windows
    - open
    - documentation
conf_ascp_sdk_folder:
  tags:
    - save_output
    - nodoc
  command:
    - --show-config
    - --fields=sdk_folder
conf_ascp_install:
  depends_on:
    - conf_ascp_sdk_folder
  pre:
    - puts(read_value_from('conf_ascp_sdk_folder'))
  command:
    - config
    - ascp
    - install
    - 1.1.3
conf_ascp_installb:
  depends_on:
    - conf_ascp_install
  command:
    - config
    - ascp
    - install
conf_ascp_installc:
  pre:
    - (TMP / 'sdk_test_dir').rmtree
  command:
    - config
    - ascp
    - install
    - --sdk-folder=$(TMP / 'sdk_test_dir')
conf_ascp_installd:
  command:
    - config
    - transferd
    - list
conf_ascp_installe:
  command:
    - config
    - transferd
    - install
conf_ascp_installf:
  tags:
    - save_output
    - nodoc
  command:
    - config
    - transferd
    - list
    - --select=@json:{"platform":"osx-arm64","version":"1.1.3"}
    - --fields=url
conf_ascp_installg:
  tags:
    - nodoc
  depends_on:
    - conf_ascp_installf
  command:
    - config
    - download
    - $(read_value_from 'conf_ascp_installf')
    - --to-folder=$(TMP)
conf_ascp_8:
  depends_on:
    - conf_ascp_install
  command:
    - config
    - ascp
    - info
    - --sdk-folder=$(TMP / 'sdk_test_dir')
conf_pset_1:
  tags:
    - tmp_conf
  command:
    - config
    - preset
    - set
    - conf_name
    - param
    - value
conf_pset_1b:
  tags:
    - tmp_conf
  command:
    - config
    - preset
    - unset
    - conf_name
    - param
conf_pset_1c:
  tags:
    - nodoc
  command:
    - config
    - preset
    - lookup
    - --url=@preset:faspex4_user.url
    - --username=@preset:faspex4_user.username
conf_pset_2:
  tags:
    - tmp_conf
  command:
    - config
    - preset
    - show
    - conf_name
conf_pset_3:
  tags:
    - tmp_conf
  command:
    - config
    - preset
    - set
    - default
    - shares
    - conf_name
conf_pset_4:
  tags:
    - tmp_conf
  command:
    - config
    - preset
    - delete
    - conf_name
conf_pset_5:
  tags:
    - tmp_conf
  command:
    - config
    - preset
    - initialize
    - conf_name
    - '@json:{"p1":"v1","p2":"v2"}'
conf_pset_6:
  tags:
    - tmp_conf
  command:
    - config
    - preset
    - update
    - conf_name
    - --p1=v1
    - --p2=v2
conf_open:
  description: open configuration file in text editor
  tags:
    - tmp_conf
  command:
    - config
    - open
conf_list:
  tags:
    - tmp_conf
  command:
    - config
    - preset
    - list
conf_over:
  tags:
    - tmp_conf
  command:
    - config
    - preset
    - overview
conf_vers_check:
  tags:
    - tmp_conf
  command:
    - config
    - preset
    - set
    - GLOBAL
    - version_check_days
    - 0
conf_gem:
  command:
    - config
    - gem
    - path
conf_gemb:
  command:
    - config
    - gem
    - version
conf_gemc:
  command:
    - config
    - gem
    - name
conf_gemd:
  command:
    - config
    - folder
conf_geme:
  command:
    - config
    - file
conf_gemf:
  command:
    - config
    - smtp_settings
conf_initdemo:
  tags:
    - tmp_conf
  command:
    - config
    - initdemo
conf_gem2:
  tags:
    - nodoc
  command:
    - config
    - gem
    - path
    - --http-proxy=http://test1
    - --http-options=@json:{"user_agent":"test1"}
conf_gem2b:
  tags:
    - nodoc
  command:
    - config
    - coffee
    - --cert_stores=@ruby:[OpenSSL::X509::DEFAULT_CERT_DIR,OpenSSL::X509::DEFAULT_CERT_FILE]
    - --http-options=@json:{"ssl_options":["CIPHER_SERVER_PREFERENCE","-NETSCAPE_CA_DN_BUG"]}
    - --insecure=yes
conf_vault_macos:
  tags:
    - nodoc
  command:
    - -N
    - config
    - vault
    - info
    - --vault=@json:{"type":"system"}
conf_vault_macosb:
  tags:
    - ignore_fail
    - nodoc
  command:
    - -N
    - config
    - vault
    - create
    - '@json:{"label":"foo"}'
    - --vault=@json:{"type":"system"}
conf_vault_macosc:
  tags:
    - nodoc
  command:
    - -N
    - config
    - vault
    - show
    - foo
    - --vault=@json:{"type":"system"}
conf_vault_macosd:
  tags:
    - ignore_fail
    - nodoc
  command:
    - -N
    - config
    - vault
    - delete
    - foo
    - --vault=@json:{"type":"system"}
conf_vault_file:
  tags:
    - tmp_conf
    - nodoc
  command:
    - config
    - preset
    - set
    - GLOBAL
    - vault
    - '@json:{"type":"file","file":"$(PATH_VAULT_FILE)"}'
conf_vault_file2:
  depends_on:
    - conf_vault_file
  tags:
    - tmp_conf
    - nodoc
  command:
    - config
    - preset
    - set
    - GLOBAL
    - vault_password
    - _simple_one_
conf_vault_create:
  depends_on:
    - conf_vault_file2
  tags:
    - tmp_conf
  command:
    - config
    - vault
    - create
    - '@json:{"label":"my_label","password":"my_password_here","description":"my secret"}'
conf_vault_info:
  depends_on:
    - conf_vault_create
  tags:
    - tmp_conf
  command:
    - config
    - vault
    - info
conf_vault_list2:
  depends_on:
    - conf_vault_create
  tags:
    - tmp_conf
  command:
    - config
    - vault
    - list
conf_vault_show:
  depends_on:
    - conf_vault_create
  tags:
    - tmp_conf
  command:
    - config
    - vault
    - show
    - my_label
conf_preset_ask:
  stdin: "username\npassword\n\nthe_user\nthe_pass\n"
  tags:
    - tmp_conf
    - nodoc
  command:
    - config
    - preset
    - ask
    - my_preset
conf_preset_secure:
  tags:
    - tmp_conf
    - nodoc
  command:
    - config
    - preset
    - secure
    - my_preset
conf_vault_pass:
  tags:
    - tmp_conf
    - nodoc
  command:
    - config
    - vault
    - password
    - $(NEW_VAULT_PASS)
conf_vault_pass2:
  tags:
    - tmp_conf
    - nodoc
  command:
    - config
    - preset
    - set
    - GLOBAL
    - vault_password
    - $(NEW_VAULT_PASS)
conf_vault_list:
  tags:
    - tmp_conf
  command:
    - config
    - vault
    - list
conf_vault_delete_label:
  tags:
    - tmp_conf
  command:
    - config
    - vault
    - delete
    - my_label
conf_echo_vault:
  depends_on:
    - conf_preset_secure
  tags:
    - tmp_conf
  command:
    - config
    - echo
    - "@vault:my_preset.password"
conf_echo_fail1:
  tags:
    - must_fail
    - tmp_conf
    - nodoc
  command:
    - config
    - echo
    - "@vault:bad"
conf_echo_fail2:
  tags:
    - must_fail
    - tmp_conf
    - nodoc
  command:
    - config
    - echo
    - "@vault:bad.password"
conf_echo_fail3:
  tags:
    - must_fail
    - tmp_conf
    - nodoc
  command:
    - config
    - echo
    - "@vault:my_preset.bad"
conf_help_1:
  tags:
    - nodoc
  command:
    - -h
conf_help_2:
  tags:
    - nodoc
  command:
    - --bash-comp
conf_coffee_1:
  command:
    - config
    - coffee
conf_coffee_2:
  command:
    - config
    - coffee
    - --ui=text
conf_coffee_3:
  command:
    - config
    - coffee
    - --ui=text
    - --image=@json:{"text":true}
conf_coffee_4:
  command:
    - config
    - coffee
    - --ui=text
    - --image=@json:{"text":true,"double":false}
conf_image:
  command:
    - config
    - image
    - https://eudemo.asperademo.com/wallpaper.jpg
conf_plugins:
  command:
    - config
    - plugins
    - list
conf_plugins1:
# unset: to test like on Windows
  env:
    LC_ALL: null
    LC_CTYPE: null
    LANG: null
  command:
    - config
    - plugins
    - list
conf_plugins2:
  command:
    - config
    - plugins
    - create
    - my_command
    - $(TMP)
conf_plugins3:
  tags:
    - nodoc
  depends_on:
    - conf_plugins2
  command:
    - my_command
    - --plugin-folder=$(TMP)
conf_genkey1:
  pre:
    - (TMP / 'my_key').delete rescue nil
    - (TMP / 'my_key.pub').delete rescue nil
  command:
    - config
    - genkey
    - $(TMP / 'my_key')
conf_genkey2:
  pre:
    - (TMP / 'my_key').delete rescue nil
    - (TMP / 'my_key.pub').delete rescue nil
  command:
    - config
    - genkey
    - $(TMP / 'my_key')
    - 4096
conf_pub_key:
  command:
    - config
    - pubkey
    - "@file:$(TMP / 'my_key')"
conf_genkey_fail:
  tags:
    - hide_fail
    - nodoc
  command:
    - config
    - genkey
    - $(TMP / 'my_key')
    - not_int
conf_cert:
  command:
    - config
    - remote_certificate
    - name
    - "@preset:node_user.url"
conf_chain:
  command:
    - config
    - remote_certificate
    - chain
    - "@preset:node_user.url"
conf_cert_only:
  command:
    - config
    - remote_certificate
    - only
    - "@preset:node_user.url"
conf_smtp:
  command:
    - config
    - email_test
    - --notify-to=@preset:misc.email_external
conf_pac:
  command:
    - config
    - proxy_check
    - --fpac=@file:$(TST / 'proxy.pac')
    - https://eudemo.asperademo.com
    - --proxy-credentials=@list:,user,pass
conf_check_update:
  command:
    - config
    - check_update
conf_check_update2:
  depends_on:
    - conf_check_update
  pre:
    - PATH_VERSION_CHECK_PERSIST.delete
  command:
    - config
    - check_update
conf_doc:
  command:
    - config
    - doc
conf_doc2:
  command:
    - config
    - doc
    - transfer-parameters
conf_echo_simple:
  command:
    - config
    - echo
    - hello
conf_echo_uri_file_only:
  command:
    - config
    - echo
    - "@uri:/etc/hosts"
conf_echo_uri_file:
  command:
    - config
    - echo
    - "@uri:file:/etc/hosts"
conf_echo_uri_http:
  command:
    - config
    - echo
    - "@uri:http://ifconfig.me"
conf_echo_uri_https:
  command:
    - config
    - echo
    - "@uri:https://ifconfig.me"
conf_echo_base:
  command:
    - config
    - echo
    - "@base64:SGVsbG8gV29ybGQK"
conf_echo_list:
  command:
    - config
    - echo
    - "@list:,1,2,3"
conf_echo_env:
  command:
    - config
    - echo
    - "@env:USER"
conf_echo_raw:
  command:
    - config
    - echo
    - --
    - --special-string
conf_echo_json_multi_yes:
  command:
    - config
    - echo
    - '@json:[{"user":{"id":1,"name":"foo"},"project":"bar"}]'
    - --multi-single=yes
conf_echo_json_multi_single:
  command:
    - config
    - echo
    - '@json:[{"user":{"id":1,"name":"foo"},"project":"bar"}]'
    - --multi-single=single
conf_echo_picture:
  command:
    - config
    - echo
    - <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="50" fill="#006699"/></svg>
    - --format=image
conf_echo_fail2b:
  tags:
    - must_fail
    - nodoc
  command:
    - config
    - echo
    - "@file:no_such_file"
conf_echo_fail4:
  tags:
    - must_fail
    - nodoc
  command:
    - config
    - echo
    - '@json:{"ok":1,"bad":mauvais}'
conf_echo_stdin:
  stdin: "1\n2\n3"
  command:
    - config
    - echo
    - "@lines:@stdin:"
conf_echo_stdbin:
  stdin: "1\n2\n3"
  command:
    - config
    - echo
    - "@stdbin:"
conf_echo_stdin_csv:
  stdin: "t1,t2,t3\na,b,d\nd,e,f"
  command:
    - config
    - echo
    - "@csvt:@stdin:"
conf_echo_stdin_zlib:
  stdin: $(Zlib::Deflate.deflate("Hello World"))
  command:
    - config
    - echo
    - "@zlib:@stdin:"
conf_echo_json_format_text:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=text
conf_echo_json_format_ruby:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=ruby
conf_echo_json_format_json:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=json
conf_echo_json_format_jsonpp:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=jsonpp
conf_echo_json_format_yaml:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=yaml
conf_echo_json_format_table:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=table
conf_echo_json_format_csv:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=csv
conf_echo_json_a:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=csv
    - --table=@json:{"headers":true,"force_quotes":true}
conf_echo_json_b:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --fields=@json:["id"]
conf_echo_json_c:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --fields=@re:i+
conf_echo_json_fields_ruby:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --fields=@ruby:->(f){f.eql?("id")}
conf_echo_json_select_ruby:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --select=@ruby:->(r){r["id"].eql?(8)}
conf_extended1:
  tags:
    - nodoc
  expect: '@file:foo'
  command:
    - config
    - echo
    - '@val:@file:foo'
    - --format=text
conf_extended2:
  tags:
    - nodoc
  expect: 'foo'
  command:
    - config
    - echo
    - '@base64:Zm9v'
    - --format=text
conf_extended3:
  tags:
    - nodoc
  expect: '["1", "2"]'
  command:
    - config
    - echo
    - '@lines:@json:"1\n2\n"'
    - --format=ruby
conf_extended4:
  tags:
    - nodoc
  expect: '["1", "2"]'
  command:
    - config
    - echo
    - '@list:,1,2'
    - --format=ruby
conf_extended5:
  tags:
    - nodoc
  expect: '["1", "2"]'
  command:
    - config
    - echo
    - '@json:["1","2"]'
    - --format=ruby
conf_extended6:
  tags:
    - nodoc
  expect: '[1, 2]'
  command:
    - config
    - echo
    - '@yaml:@json:"- 1\n- 2\n"'
    - --format=ruby
conf_interactive:
  command:
    - config
    - echo
    - "@secret:"
conf_hint:
  tags:
    - must_fail
    - nodoc
  command:
    - config
    - test
    - throw
    - Aspera::RestCallError
    - Signature has expired
config_hint_a:
  tags:
    - must_fail
    - nodoc
  command:
    - config
    - test
    - throw
    - Aspera::Transfer::Error
    - Remote host is not who weexpected
config_hint_b:
  tags:
    - must_fail
    - nodoc
  command:
    - config
    - test
    - throw
    - OpenSSL::SSL::SSLError
    - does not match the server certificate
config_hint_c:
  tags:
    - must_fail
    - nodoc
  command:
    - config
    - test
    - throw
    - OpenSSL::SSL::SSLError
    - certificate verify failed
config_hint_d:
  tags:
    - must_fail
    - nodoc
  command:
    - config
    - test
    - throw
    - OpenSSL::PKey::RSAError
    - Neither PUB key nor PRIV key
conf_logger:
  command:
    - config
    - file
    - --log-level=debug
    - --logger=syslog
config_file_a:
  command:
    - config
    - file
    - --log-level=debug
    - --log-format=standard
config_file_b:
  command:
    - config
    - file
    - --log-level=debug
    - --log-format=default
config_log_trace_caller:
  command:
    - config
    - coffee
    - --log-level=trace2
    - --log-format=caller
config_log_custom:
  command:
    - config
    - file
    - --log-level=debug
    - |
      --log-format=@ruby:->(s, d, p, m){"#{d.strftime("%Y-%m-%d %H:%M:%S")} - #{p} - #{s} - #{m}\n"}
config_log_all:
  tags:
    - nodoc
  command:
    - config
    - echo
    - '@ruby:%i[trace2 trace1 debug info warn error fatal unknown].each{|i|Log.log.send(i,"<"*80)};"ok"'
    - --log-level=trace2
prev_check:
  command:
    - preview
    - check
    - --skip-types=office
prev_dcm:
  command:
    - preview
    - test
    - --base=$(TMP / 'prev_dcm')
    - "@preset:file.dcm"
prev_dcm_mm:
  command:
    - preview
    - test
    - --mimemagic=yes
    - --base=$(TMP / 'prev_dcm_mm')
    - "@preset:file.dcm"
prev_jpg_unk_mm:
  command:
    - preview
    - test
    - --mimemagic=yes
    - --base=$(TMP / 'prev_jpg_unk_mm')
    - "@preset:file.jpg_unk"
prev_mxf_blend:
  command:
    - preview
    - test
    - --base=$(TMP / 'prev_mxf_blend')
    - "@preset:file.mxf"
    - mp4
    - --video-conversion=blend
    - --query=@json:{"text":true,"double":true}
prev_pdf:
  command:
    - preview
    - show
    - --base=$(TMP / 'prev_pdf')
    - "@preset:file.pdf"
prev_txt:
  command:
    - preview
    - show
    - --base=$(TMP / 'prev_txt')
    - /etc/hosts
prev_docx:
  command:
    - preview
    - show
    - --base=$(TMP / 'prev_docx')
    - "@preset:file.docx"
prev_mpg_png_fix:
  command:
    - preview
    - show
    - --base=$(TMP / 'prev_mpg_png_fix')
    - "@preset:file.mpg"
    - --video-png-conv=fixed
prev_mpg_png_ani:
  command:
    - preview
    - show
    - --base=$(TMP / 'prev_mpg_png_ani')
    - "@preset:file.mpg"
    - --video-png-conv=animated
prev_mpg_reencode:
  command:
    - preview
    - show
    - --base=$(TMP / 'prev_mpg_reencode')
    - "@preset:file.mpg"
    - mp4
    - --video-conversion=reencode
prev_mpg_clips:
  command:
    - preview
    - show
    - --base=$(TMP / 'testprev_mpg_clips_name')
    - "@preset:file.mpg"
    - mp4
    - --video-conversion=clips
prev_trevents_prep:
  command:
    - --preset=preview_ak
    - node
    - upload
    - "@preset:file.mxf"
    - "@preset:file.docx"
    - --ts=@json:{"target_rate_kbps":1000000,"resume_policy":"none"}
  post:
    - sleep 4
prev_trevents:
  depends_on:
    - prev_trevents_prep
  command:
    - preview
    - trevents
    - --once-only=yes
    - --skip-types=office
    - --log-level=info
prev_events_prep:
  command:
    - --preset=preview_ak
    - node
    - upload
    - "@preset:file.mxf"
    - "@preset:file.docx"
    - --ts=@json:{"target_rate_kbps":1000000,"resume_policy":"none"}
  post:
    - sleep 4
prev_events:
  depends_on:
    - prev_events_prep
  command:
    - preview
    - events
    - --once-only=yes
    - --skip-types=office
    - --log-level=info
prev_scana:
  command:
    - preview
    - scan
    - --skip-types=office
    - --log-level=info
    - --skip-folder=/special/folder
prev_scanb:
  tags:
    - nodoc
  command:
    - preview
    - scan
    - --skip-folder=foo
    - --skip-folder=bar
    - --skip-folder=@list:,1,2
prev_folder:
  command:
    - preview
    - scan
    - --scan-id=1
    - --skip-types=office
    - --log-level=info
    - --file-access=remote
    - --ts=@json:{"target_rate_kbps":1000000}
serv_hot_prep:
  tags:
    - ignore_fail
    - nodoc
  command:
    - server
    - delete
    - "@extend:@preset:server.upload_folder@/target_hot"
serv_hot_prep2:
  depends_on:
    - serv_hot_prep
  command:
    - server
    - mkdir
    - "@extend:@preset:server.upload_folder@/target_hot"
serv_hot_run:
  $comment: First run transfers nothing because file is too recent
  pre:
    - Pathname.new('source_hot').rmtree
    - Pathname.new('source_hot').mkdir
    - Pathname.new('source_hot/new_file').write('hello')
  command:
    - server
    - upload
    - --to-folder=@extend:@preset:server.upload_folder@/target_hot
    - --lock-port=12345
    - --transfer-info=@json:{"ascp_args":["--remove-after-transfer","--remove-empty-directories","--exclude-newer-than=-8","--src-base","source_hot"]}
    - source_hot
serv_hot_check:
  depends_on:
    - serv_hot_run
  pre:
    - system 'ls -al source_hot'
  command:
    - server
    - browse
    - "@extend:@preset:server.upload_folder@/target_hot"
  post:
    - sleep TEMPORIZE_CREATE
serv_hot_run2:
  $comment: Second run transfers file
  depends_on:
    - serv_hot_check
  command:
    - server
    - upload
    - --to-folder=@extend:@preset:server.upload_folder@/target_hot
    - --lock-port=12345
    - --transfer-info=@json:{"ascp_args":["--remove-after-transfer","--remove-empty-directories","--exclude-newer-than=-8","--src-base","source_hot"]}
    - source_hot
serv_hot_check2:
  depends_on:
    - serv_hot_run2
  command:
    - server
    - browse
    - "@extend:@preset:server.upload_folder@/target_hot"
tcos_info1:
  command:
    - -N
    - cos
    - node
    - info
    - --bucket=@preset:icos.bucket
    - --region=@preset:icos.region
    - --service-credentials=@json:@file:@preset:file.cos_svc_cred
tcos_info2:
  command:
    - -N
    - cos
    - node
    - info
    - --bucket=@preset:icos.bucket
    - --endpoint=@preset:icos.endpoint
    - --apikey=@preset:icos.api_key
    - --crn=@preset:icos.resource_instance_id
tcos_info3:
  command:
    - cos
    - node
    - info
    - --log-level=trace2
tcos_show:
  tags:
    - ignore_fail
    - nodoc
  command:
    - cos
    - node
    - access_key
    - show
    - self
tcos_upload:
  command:
    - cos
    - node
    - upload
    - $(PATH_TST_ASC_LCL)
tcos_download:
  depends_on:
    - tcos_upload
  command:
    - cos
    - node
    - download
    - "@preset:file.asc_name"
    - --to-folder=$(TMP)
f5_health:
  command:
    - -N
    - faspex5
    - health
    - --url=@preset:faspex5_user.url
f5_health_bad:
  tags:
    - nodoc
  command:
    - -N
    - faspex5
    - health
    - --url=https://www.ibm.com
f5_health_nagios:
  tags:
    - must_fail
    - nodoc
  command:
    - -N
    - faspex5
    - health
    - --url=https://www.ibm.com
    - --format=nagios
f5_detect:
  command:
    - config
    - detect
    - "@preset:faspex5_user.url"
    - faspex5
f5_wizard:
  command:
    - config
    - wizard
    - "@preset:faspex5_user.url"
    - faspex5
    - --key-path=@preset:file.private_key
    - --preset=faspex5_user
f5_wizardb:
  tags:
    - nodoc
  command:
    - config
    - wizard
    - "@preset:faspex5_user.url"
    - faspex5
    - --key-path=@preset:file.private_key
    - --url=
    - --username=a@b.c
f5_wizardc:
  tags:
    - nodoc
  command:
    - config
    - wizard
    - https://eudemo.asperademo.com
    - faspex5
    - --username=admin@ibm.com
    - --key-path=
    - --show-secrets=yes
    - --client-id=abc
    - --client-secret=abc
f5_detect_fail:
  tags:
    - hide_fail
    - nodoc
  command:
    - config
    - detect
    - https://eudemo.asperademo.com:22
    - faspex5
f5_detect_ok:
  command:
    - -N
    - config
    - detect
    - "@preset:faspex5_user.url"
f5_detect_okb:
  command:
    - config
    - detect
    - "@preset:faspex5_user.url"
f5_version:
  command:
    - faspex5
    - version
f5_pack_rcv_init:
  command:
    - faspex5
    - packages
    - receive
    - INIT
    - --once-only=yes
f5_p1:
  command:
    - faspex5
    - packages
    - send
    - '@json:@extend:{"title":"test title","recipients":[{"name":"@preset:faspex5_user.username@"}]@preset:faspex5.meta@}'
    - $(PATH_TST_ASC_LCL)
    - --ts=@json:{"content_protection_password":"my_secret_here"}
f5_pack_list:
  command:
    - faspex5
    - packages
    - list
    - --query=@json:{"mailbox":"inbox","status":"completed"}
f5_pack_list_admin:
  command:
    - --preset=f5_admin
    - faspex5
    - packages
    - list
    - --box=ALL
f5_pack_list_out:
  command:
    - faspex5
    - packages
    - list
    - --box=outbox
    - --fields=DEF,sender.email,recipients.0.recipient_type
f5_sh_folder_list:
  command:
    - faspex5
    - shared_folders
    - list
f5_sh_folder_br:
  command:
    - faspex5
    - shared_folders
    - browse
    - "@extend:%name:@preset:faspex5.shared_folder_name@"
f5_p3a:
  tags:
    - save_output
    - nodoc
  command:
    - faspex5
    - packages
    - send
    - --shared-folder=@extend:%name:@preset:faspex5.shared_folder_name@
    - '@json:@extend:{"title":"test title","recipients":["@preset:misc.email_internal@"]}'
    - "@preset:faspex5.shared_folder_file"
    - --fields=id
    - --display=data
  post:
    - 'puts "Sent package with id: #{read_value_from "f5_p3a"}"'
f5_p3aa:
  depends_on:
    - f5_p3a
  command:
    - faspex5
    - packages
    - status
    - $(read_value_from 'f5_p3a')
    - "@list:,failed,completed"
f5_package_id:
  depends_on:
    - f5_p3a
  tags:
    - save_output
    - nodoc
  command:
    - faspex5
    - packages
    - list
    - --query=@json:{"status":"completed","max":1}
    - --fields=id
f5_p3c:
  depends_on:
    - f5_package_id
  command:
    - faspex5
    - packages
    - show
    - $(read_value_from 'f5_package_id')
f5_p3d:
  depends_on:
    - f5_package_id
  command:
    - faspex5
    - packages
    - status
    - $(read_value_from 'f5_package_id')
f5_p3e:
  depends_on:
    - f5_package_id
  command:
    - faspex5
    - packages
    - browse
    - $(read_value_from 'f5_package_id')
    - --query=@json:{"recursive":true}
f5_p3f:
  depends_on:
    - f5_package_id
  command:
    - faspex5
    - packages
    - receive
    - $(read_value_from 'f5_package_id')
    - --to-folder=$(TMP)
    - --ts=@json:{"content_protection_password":"my_secret_here"}
f5_p3g:
  depends_on:
    - f5_package_id
  command:
    - faspex5
    - packages
    - receive
    - ALL
    - --once-only=yes
    - --to-folder=$(TMP)
f5_p3h:
  depends_on:
    - f5_p3g
  command:
    - faspex5
    - packages
    - delete
    - $(read_value_from 'f5_package_id')
f5_pack_shbox:
  command:
    - faspex5
    - packages
    - send
    - '@json:@extend:{"title":"test title","recipients":["@preset:faspex5.shared_box_name@"],"metadata":{"Options":"Opt1","TextInput":"example text"}}'
    - $(PATH_TST_ASC_LCL)
  post:
    - puts 'Waiting for package to be available'
    - sleep 30
f5_pack_shboxb:
  depends_on:
    - f5_pack_shbox
  command:
    - faspex5
    - packages
    - list
    - --box=@preset:faspex5.shared_box_name
f5_pack_shboxc:
  depends_on:
    - f5_pack_shboxb
  tags:
    - save_output
    - nodoc
  command:
    - faspex5
    - packages
    - list
    - --box=@preset:faspex5.shared_box_name
    - --query=@json:{"status":"completed","limit":1,"max":1}
    - --fields=id
    - --format=csv
    - --display=data
f5_pack_shboxd:
  depends_on:
    - f5_pack_shboxc
  command:
    - faspex5
    - packages
    - show
    - --box=@preset:faspex5.shared_box_name
    - $(read_value_from 'f5_pack_shboxc')
f5_pack_shboxe:
  depends_on:
    - f5_pack_shboxc
  command:
    - faspex5
    - packages
    - receive
    - --box=@preset:faspex5.shared_box_name
    - $(read_value_from 'f5_pack_shboxc')
    - --to-folder=$(TMP)
f5_pack_shbox_public:
  command:
    - -N
    - faspex5
    - packages
    - send
    - --url=@preset:faspex5.public_link_send_shared_box
    - '@json:@extend:{"title":"test title"}'
    - $(PATH_TST_ASC_LCL)
f5_pack_user_public:
  command:
    - -N
    - faspex5
    - packages
    - send
    - --url=@preset:faspex5.public_link_send_f5_user
    - '@json:@extend:{"title":"test title"}'
    - $(PATH_TST_ASC_LCL)
f5_pack_wrkgrp:
  command:
    - faspex5
    - packages
    - send
    - '@json:@extend:{"title":"test title","recipients":["@preset:faspex5.workgroup@"]}'
    - $(PATH_TST_ASC_LCL)
  post:
    - sleep TEMPORIZE_CREATE
f5_pack_wrkgrpb:
  depends_on:
    - f5_pack_wrkgrp
  command:
    - faspex5
    - packages
    - list
    - --box=@preset:faspex5.workgroup
    - --group-type=workgroups
workgroup_package_id1:
  depends_on:
    - f5_pack_wrkgrp
  tags:
    - save_output
    - nodoc
  command:
    - faspex5
    - packages
    - list
    - --box=@preset:faspex5.workgroup
    - --group-type=workgroups
    - --query=@json:{"status":"completed","limit":1,"max":1}
    - --fields=id
f5_pack_wrkgrpd:
  depends_on:
    - workgroup_package_id1
  command:
    - faspex5
    - packages
    - show
    - --box=@preset:faspex5.workgroup
    - --group-type=workgroups
    - $(read_value_from 'workgroup_package_id1')
f5_pack_wrkgrpe:
  depends_on:
    - workgroup_package_id1
  command:
    - faspex5
    - packages
    - receive
    - --box=@preset:faspex5.workgroup
    - --group-type=workgroups
    - $(read_value_from 'workgroup_package_id1')
    - --to-folder=$(TMP)
f5_sh_fold:
  command:
    - faspex5
    - shared
    - list
f5_sh_foldb:
  command:
    - faspex5
    - shared
    - browse
    - "%name:@preset:faspex4.src"
f5_user_bearer:
  command:
    - faspex5
    - bearer_token
f5_user_contacts:
  command:
    - faspex5
    - admin
    - contacts
    - list
f5_admin_workgroups:
  command:
    - faspex5
    - admin
    - workgroups
    - list
f5_admin_shared_inboxes:
  command:
    - faspex5
    - admin
    - shared_inboxes
    - list
f5_admin_saml_configs:
  command:
    - faspex5
    - admin
    - saml_configs
    - list
f5_admin_metadata_profiles:
  command:
    - faspex5
    - admin
    - metadata_profiles
    - list
f5_admin_configuration:
  command:
    - faspex5
    - admin
    - configuration
    - show
f5_dist_create:
  command:
    - faspex5
    - admin
    - distribution_lists
    - create
    - '@json:{"name":"test4","contacts":[{"name":"john@example.com"}]}'
  post:
    - sleep TEMPORIZE_CREATE
f5_dist_list:
  depends_on:
    - f5_dist_create
  command:
    - faspex5
    - admin
    - distribution_lists
    - list
    - --query=@json:{"type":"global"}
f5_dist_delete:
  depends_on:
    - f5_dist_list
  command:
    - faspex5
    - admin
    - distribution_lists
    - delete
    - "%name:test4"
f5_adm_acc_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - accounts
    - list
f5_adm_job_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - jobs
    - list
    - --query=@json:{"job_type":"email","status":"failed"}
    - --fields=id,error_desc
f5_adm_nod_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - list
f5_adm_nod_show:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - show
    - "%name:Local"
f5_adm_nod_br:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - browse
    - "%name:Local"
f5_adm_nod_sh_list:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - shared_folders
    - "%name:Local"
    - list
f5_adm_nod_sh_show:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - shared_folders
    - "%name:Local"
    - show
    - "%name:Main"
f5_adm_nod_sh_usr_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - shared_folders
    - "%name:Local"
    - user
    - "%name:Main"
    - list
f5_adm_api_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - oauth_clients
    - list
f5_adm_alternate_addresses:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - alternate_addresses
    - list
f5_adm_email_notifications:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - email_notifications
    - list
f5_adm_email_notif_welcome:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - email_notifications
    - show
    - welcome_email
f5_adm_email_notif_modif:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - configuration
    - modify
    - '@json:{"mfa_required":false}'
f5_adm_reg_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - registrations
    - list
f5_adm_sbx_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - list
    - --query=@json:{"all":true}
f5_adm_sbx_mem:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - members
    - "@extend:%name:@preset:faspex5.shared_box_name@"
    - list
f5_adm_sbx_cr:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - members
    - "@extend:%name:@preset:faspex5.shared_box_name@"
    - create
    - "%name:john@example.com"
    - submit_only
f5_adm_sbx_del:
  depends_on:
    - f5_adm_sbx_cr
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - members
    - "@extend:%name:@preset:faspex5.shared_box_name@"
    - delete
    - "%name:john@example.com"
f5_adm_evt_app:
  description: Retrieve successful login in the last hour.
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - event
    - application
    - --query=@ruby:{"event_type[]"=>["login_success"],"created_at_start"=>(Time.now.utc-60).strftime("%Y-%m-%dT%H:%M:%S.%LZ")}
f5_adm_evt_web:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - event
    - webhook
f5_adm_sh_invite:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - invite
    - "@extend:%name:@preset:faspex5.shared_box_name@"
    - johnny@example.com
f5_adm_sh_members:
  depends_on:
    - f5_adm_sh_invite
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - members
    - "@extend:%name:@preset:faspex5.shared_box_name@"
    - delete
    - "%name:johnny@example.com"
f5_clean_del:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - clean_deleted
f5_smtp:
  tags:
    - must_fail
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - smtp
    - create
    - '@json:{"auth_type":"open","server_address":"smtp.gmail.com","server_port":587,"domain":"gmail.com","tls_enabled":true,"packages_recipient_from":"sender"}'
f5_smtp_mod:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - smtp
    - modify
    - '@json:{"default_time_zone_offset":"0"}'
f5_smtp_sh:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - smtp
    - show
f5_smtp_tst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - smtp
    - test
    - "@preset:misc.email_external"
f5_user_account:
  command:
    - faspex5
    - user
    - account
f5_user_account_query:
  command:
    - faspex5
    - user
    - account
    - --query.expand=true
f5_user_profile_show:
  command:
    - faspex5
    - user
    - profile
    - show
f5_user_profile_mod:
  command:
    - faspex5
    - user
    - profile
    - modify
    - '@json:{"preference":{"connect_disabled":false}}'
f5_invite_create:
  command:
    - faspex5
    - invitations
    - create
    - '@json:{"email_address":"aspera.user1+u@gmail.com"}'
f5_invite_list:
  depends_on:
    - f5_invite_create
  command:
    - faspex5
    - invitation
    - list
f5_invite_id:
  depends_on:
    - f5_invite_list
  tags:
    - save_output
    - nodoc
  command:
    - faspex5
    - invitation
    - list
    - --fields=id
    - --format=csv
f5_invited:
  tags:
    - nodoc
  depends_on:
    - f5_invite_id
  command:
    - faspex5
    - invitation
    - delete
    - --bulk=yes
    - "@lines:@file:$(out_file 'f5_invite_id')"
f5_webauth:
  command:
    - --preset=f5_web
    - faspex5
    - version
f5_fxgw_start:
  tags:
    - noblock
  command:
    - faspex5
    - gateway
    - '@json:{"url":"https://localhost:12346/aspera/faspex"}'
f5_fxgw_test:
  tags:
    - nodoc
  depends_on:
    - f5_fxgw_start
  command:
    - -N
    - faspex
    - --url=https://localhost:12346/aspera/faspex
    - --username=_unused_
    - --password=_unused_
    - package
    - send
    - --delivery-info=@json:{"recipients":["laurent.martin.aspera@fr.ibm.com"],"title":"gateway aoc"}
    - faux:///test1?1m
  post:
    - system 'curl -k https://localhost:12346/aspera/faspex/send -d bad'
    - system 'curl -k https://localhost:12346/aspera/faspex/bad -d bad'
    - stop_process 'f5_fxgw_start'
f5_postproc_start:
  tags:
    - noblock
  pre:
    - system 'openssl req -x509 -newkey rsa:2048 -sha256 -days 365 -nodes -keyout $(TMP / "key.pem") -out $(TMP / "cert.pem") -subj /CN=localhost'
    - system 'openssl pkcs12 -export -out $(TMP / "localhost.p12") -inkey $(TMP / "key.pem") -in $(TMP / "cert.pem") -passout pass:changeit'
  command:
    - faspex5
    - postprocessing
    - '@json:{"url":"https://localhost:8553/asclihook","script_folder":"$(TST)","cert":"$(TMP / "localhost.p12")","key":"changeit"}'
f5_postproc_test:
  depends_on:
    - f5_postproc_start
  command:
    - faspex5
    - packages
    - send
    - '@json:@extend:{"title":"test_webhook_ascli","recipients":["@preset:faspex5.shared_box_name@"]}'
    - faux:///test1?1m
  post:
    - |
      system %q{curl -k https://localhost:8553/asclihook/post_proc_test.sh -d '{"faspex_pkg_directory":"/package test - 61ae5292-d8ef-496e-8b15-8cdc0379fc4a.aspera-package/PKG - package test","faspex_pkg_name":"Test files","faspex_pkg_note":"","faspex_pkg_id":506,"faspex_pkg_delivery_id":506,"faspex_recipient_list":"aspera-recipient-test@ibm.com","faspex_recipient_count":1,"faspex_sender_id":30,"faspex_sender_name":"aspera-sender-test@ibm.com","faspex_sender_email":"aspera-sender-test@ibm.com","faspex_pkg_total_bytes":4633,"faspex_pkg_total_files":1,"faspex_pkg_uuid":"61ae5299-d8ea-496e-8b15-8cdc0379fc4a","faspex_metadata_fields": "{\"_pkg_uuid\":\"61ae5292-d8ef-496e-8b15-8cdc0379fc4a\",\"_pkg_name\":\"Test files\",\"_created_utc\":\"2022-1209T17:47:03.545Z\"}","faspex_recipient_0":"aspera-sender-test@ibm.com"}'}
    - system 'curl -k https://localhost:8553/wrong -d {}'
    - sleep 5
    - stop_process 'f5_postproc_start'
f5_postproc_test_with_key:
  tags:
    - noblock
    - nodoc
  command:
    - faspex5
    - postprocessing
    - '@json:{"url":"https://localhost:8553/asclihook","script_folder":"$(TST)","key":"$(TMP / "key.pem")"}'
  post:
    - sleep 5
    - stop_process 'f5_postproc_test_with_key'
f5_postproc_test_with_key_cert:
  tags:
    - noblock
    - nodoc
  command:
    - faspex5
    - postprocessing
    - '@json:{"url":"https://localhost:8553/asclihook","script_folder":"$(TST)","cert":"$(TMP / "cert.pem")","key":"$(TMP / "key.pem")"}'
  post:
    - sleep 5
    - stop_process 'f5_postproc_test_with_key_cert'
f5_cert_test:
  tags:
    - noblock
    - nodoc
  command:
    - faspex5
    - postprocessing
    - '@json:{"url":"http://localhost:18080/domain","script_folder":"$(TST)"}'
  post:
    - sleep 2
    - stop_process 'f5_cert_test'
f5_cert_testb:
  tags:
    - noblock
    - nodoc
  command:
    - faspex5
    - postprocessing
    - '@json:{"url":"https://localhost:18443/domain","certificate":{},"script_folder":"$(TST)"}'
  post:
    - sleep 2
    - stop_process 'f5_cert_testb'
f5_cert_testc:
  tags:
    - noblock
    - nodoc
  pre:
    - system 'openssl req -newkey rsa:2048 -x509 -days 365 -nodes -keyout $(TMP / "private_key.pem") -out $(TMP / "certificate.pem") -subj /CN=MyCert'
  command:
    - faspex5
    - postprocessing
    - '@json:{"url":"https://localhost:18443/domain","certificate":{"cert":"$(TMP / "certificate.pem")","chain":"$(TMP / "certificate.pem")","key":"$(TMP / "private_key.pem")"},"script_folder":"$(TST)"}'
  post:
    - sleep 2
    - stop_process 'f5_cert_testc'
f5_cert_testd:
  tags:
    - noblock
    - nodoc
  pre:
    - system 'openssl pkcs12 -export -out $(TMP / "certificate.p12") -inkey $(TMP / "private_key.pem") -in $(TMP / "certificate.pem") -name MyCertAlias -passout pass:"$(PKCS_P)"'
  command:
    - faspex5
    - postprocessing
    - '@json:{"url":"https://localhost:18443/domain","certificate":{"pkcs12":"$(TMP / "certificate.p12")","key":"$(PKCS_P)"},"script_folder":"$(TST)"}'
  post:
    - sleep 2
    - stop_process 'f5_cert_testd'
httpgw_nagios:
  command:
    - httpgw
    - health
httpgw_info:
  command:
    - httpgw
    - info
httpgw_detect:
  command:
    - config
    - detect
    - "@preset:tst_httpgw.url"
    - httpgw
faspio_health:
  command:
    - faspio
    - health
faspio_detect:
  command:
    - config
    - detect
    - "@preset:tst_faspio.url"
    - faspio
faspio_wizard:
  command:
    - config
    - wizard
    - "@preset:tst_faspio.url"
    - faspio
    - --username=@preset:tst_faspio.username
    - --password=@preset:tst_faspio.password
faspio_blist:
  command:
    - faspio
    - bridges
    - list
faspio_bcreate:
  command:
    - faspio
    - bridges
    - create
    - '@json:{"name":"test1","local":{"protocol":"tcp","tls_enabled":false,"port":"3000","bind_address":"127.0.0.1"},"forward":{"protocol":"fasp","tls_enabled":false,"port":"3994","bind_address":"127.0.0.1","host":["10.0.0.1"]}}'
faspio_bclean_list:
  depends_on:
    - faspio_bcreate
  tags:
    - save_output
    - nodoc
  command:
    - faspio
    - bridges
    - list
    - --fields=id
    - --format=json
faspio_bclean:
  depends_on:
    - faspio_bclean_list
  command:
    - faspio
    - bridges
    - delete
    - --bulk=yes
    - "@json:$(read_value_from 'faspio_bclean_list')"
alee_nagios:
  command:
    - -N
    - alee
    - health
alee_entitlement:
  command:
    - alee
    - entitlement
f4_health:
  command:
    - faspex
    - health
f4_health_bad:
  tags:
    - nodoc
  command:
    - faspex
    - health
    - --url=https://wrong.example.com
f4_detect:
  tags:
    - faspex
    - nodoc
  command:
    - config
    - detect
    - "@preset:faspex4_user.url"
f4_wizard:
  command:
    - config
    - wizard
    - "@preset:faspex4_user.url"
    - faspex
    - --username=test
    - --password=test
f4_pack_list:
  command:
    - faspex
    - package
    - list
    - --query.max=5
f4_pack_send:
  command:
    - faspex
    - package
    - send
    - --delivery-info=@json:@extend:{"title":"$(name) $(PACKAGE_TITLE_BASE)","recipients":["@preset:misc.email_internal@","@preset:faspex4_user.username@"]}
    - $(PATH_TST_ASC_LCL)
  post:
    - sleep 8
f4_prs:
  depends_on:
    - f4_pack_send
  tags:
    - save_output
    - nodoc
  command:
    - faspex
    - package
    - list
    - --query.max=1
    - --fields=package_id
    - --display=data
    - --format=csv
f4_prsb:
  command:
    - faspex
    - package
    - receive
    - $(read_value_from 'f4_prs')
    - --to-folder=$(TMP)
f4_prsc:
  tags:
    - save_output
    - nodoc
  command:
    - faspex
    - package
    - list
    - --box=sent
    - --query.max=1
    - --fields=package_id
    - --display=data
    - --format=csv
f4_prsd:
  command:
    - faspex
    - package
    - receive
    - $(read_value_from 'f4_prsc')
    - --to-folder=$(TMP)
    - --box=sent
f4_pria:
  tags:
    - save_output
    - nodoc
  command:
    - faspex
    - package
    - list
    - --query.max=1
    - --fields=package_id
    - --display=data
    - --format=csv
f4_prib:
  command:
    - faspex
    - package
    - receive
    - $(read_value_from 'f4_pria')
    - --to-folder=$(TMP)
f4_prl:
  tags:
    - hide_fail
    - nodoc
  command:
    - faspex
    - package
    - receive
    - --to-folder=$(TMP)
    - --link=@preset:faspex4.link_recv_from_user
f4_prall:
  command:
    - faspex
    - package
    - receive
    - ALL
    - --once-only=yes
    - --to-folder=$(TMP)
    - --query=@json:{"max":10}
f4_pslu:
  command:
    - faspex
    - package
    - send
    - --link=@preset:faspex4.link_send_to_user
    - --delivery-info=@json:{"title":"$(name) $(PACKAGE_TITLE_BASE)"}
    - $(PATH_TST_ASC_LCL)
f4_psld:
  command:
    - faspex
    - package
    - send
    - --link=@preset:faspex4.link_send_to_dropbox
    - --delivery-info=@json:{"title":"$(name) $(PACKAGE_TITLE_BASE)"}
    - $(PATH_TST_ASC_LCL)
f4_remote_src:
  command:
    - faspex
    - source
    - list
f4_remote_srcb:
  command:
    - faspex
    - source
    - info
    - "%name:@preset:faspex4.src"
    - --storage=@preset:faspex4_storage
f4_remote_srcc:
  command:
    - faspex
    - source
    - node
    - "%name:@preset:faspex4.src"
    - br
    - /
    - --storage=@preset:faspex4_storage
f4_remote_srcd:
  command:
    - faspex
    - package
    - send
    - --delivery-info=@json:@extend:{"title":"$(name) $(PACKAGE_TITLE_BASE)","recipients":["@preset:misc.email_internal@"]}
    - --remote-source=@extend:%name:@preset:faspex4.src
    - sample_source.txt
f4_misc:
  command:
    - faspex
    - me
f4_miscb:
  command:
    - faspex
    - address_book
f4_miscc:
  command:
    - faspex
    - login_methods
f4_v4:
  command:
    - --preset=faspex4_admin
    - faspex
    - v4
    - dropbox
    - list
f4_v4b:
  command:
    - --preset=faspex4_admin
    - faspex
    - v4
    - dmembership
    - list
f4_v4c:
  command:
    - --preset=faspex4_admin
    - faspex
    - v4
    - workgroup
    - list
f4_v4d:
  command:
    - --preset=faspex4_admin
    - faspex
    - v4
    - wmembership
    - list
f4_v4e:
  command:
    - --preset=faspex4_admin
    - faspex
    - v4
    - user
    - list
f4_v4f:
  command:
    - faspex
    - v4
    - metadata_profile
    - list
f4_db1:
  command:
    - faspex
    - dropbox
    - list
    - --recipient=@extend:*@preset:faspex4.dbx@
f4_db1b:
  command:
    - faspex
    - package
    - send
    - --delivery-info=@json:@extend:{"title":"$(name) $(PACKAGE_TITLE_BASE)","recipients":[*@preset:faspex4.dbx@]}
    - $(PATH_TST_ASC_LCL)
f4_db1c:
  tags:
    - save_output
    - nodoc
  command:
    - faspex
    - package
    - list
    - --recipient=@extend:*@preset:faspex4.dbx@
    - --format=csv
    - --fields=package_id
    - --query.max=1
f4_db1d:
  command:
    - faspex
    - package
    - receive
    - $(read_value_from 'f4_db1c')
    - --recipient=@extend:*@preset:faspex4.dbx@
    - --to-folder=$(TMP)
f4_db1e:
  command:
    - faspex
    - dropbox
    - list
    - --recipient=@extend:*@preset:faspex4.dbx@
f4_db1f:
  command:
    - faspex
    - package
    - send
    - --delivery-info=@json:@extend:{"title":"$(name) $(PACKAGE_TITLE_BASE)","recipients":[*@preset:faspex4.wkg@]}
    - $(PATH_TST_ASC_LCL)
  post:
    - sleep 10
f4_db1g:
  tags:
    - save_output
    - nodoc
  command:
    - faspex
    - package
    - list
    - --recipient=@extend:*@preset:faspex4.wkg@
    - --format=csv
    - --fields=package_id
    - --query.max=1
f4_db1h:
  command:
    - faspex
    - package
    - receive
    - $(read_value_from 'f4_db1g')
    - --recipient=@extend:*@preset:faspex4.wkg@
    - --to-folder=$(TMP)
