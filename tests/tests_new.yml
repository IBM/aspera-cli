conf_echo_json_format_text:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=text
conf_echo_json_format_ruby:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=ruby
conf_echo_json_format_json:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=json
conf_echo_json_format_jsonpp:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=jsonpp
conf_echo_json_format_yaml:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=yaml
conf_echo_json_format_table:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=table
conf_echo_json_format_csv:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=csv
conf_echo_json_a:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --format=csv
    - --table=@json:{"headers":true,"force_quotes":true}
conf_echo_json_b:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --fields=@json:["id"]
conf_echo_json_c:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --fields=@re:i+
conf_echo_json_fields_ruby:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --fields=@ruby:->(f){f.eql?("id")}
conf_echo_json_select_ruby:
  command:
    - config
    - echo
    - '@json:[{"name":"foo","id":1},{"name":"bar","id":8}]'
    - --select=@ruby:->(r){r["id"].eql?(8)}
conf_extended1:
  expect: '@file:foo'
  command:
    - config
    - echo
    - '@val:@file:foo'
    - --format=text
conf_extended2:
  expect: 'foo'
  command:
    - config
    - echo
    - '@base64:Zm9v'
    - --format=text
conf_extended3:
  expect: '["1", "2"]'
  command:
    - config
    - echo
    - '@lines:@json:1\n2\n'
    - --format=ruby
conf_extended4:
  expect: '["1", "2"]'
  command:
    - config
    - echo
    - '@list:,1,2'
    - --format=ruby
conf_extended5:
  expect: '["1", "2"]'
  command:
    - config
    - echo
    - '@json:["1","2"]'
    - --format=ruby
conf_extended6:
  expect: '[1, 2]'
  command:
    - config
    - echo
    - '@yaml:@json:- 1\n- 2\n'
    - --format=ruby
conf_interactive:
  command:
    - config
    - echo
    - "@secret:"
conf_hint:
  tags:
    - must_fail
  command:
    - config
    - test
    - throw
    - Aspera::RestCallError
    - Signature has expired
config_hint_a:
  tags:
    - must_fail
  command:
    - config
    - test
    - throw
    - Aspera::Transfer::Error
    - Remote host is not who weexpected
config_hint_b:
  tags:
    - must_fail
  command:
    - config
    - test
    - throw
    - OpenSSL::SSL::SSLError
    - does not match the server certificate
config_hint_c:
  tags:
    - must_fail
  command:
    - config
    - test
    - throw
    - OpenSSL::SSL::SSLError
    - certificate verify failed
config_hint_d:
  tags:
    - must_fail
  command:
    - config
    - test
    - throw
    - OpenSSL::PKey::RSAError
    - Neither PUB key nor PRIV key
conf_logger:
  command:
    - config
    - file
    - --log-level=debug
    - --logger=syslog
config_file_a:
  command:
    - config
    - file
    - --log-level=debug
    - --log-format=standard
config_file_b:
  command:
    - config
    - file
    - --log-level=debug
    - --log-format=default
config_log_trace_caller:
  command:
    - config
    - coffee
    - --log-level=trace2
    - --log-format=caller
config_log_custom:
  command:
    - config
    - file
    - --log-level=debug
    - '--log-format=@ruby:->(s,d,p,m){"#{d.strftime("%Y-%m-%d "%H:%M:%S")} - #{p} - #{s} - #{m}\n"}'
config_log_all:
  command:
    - config
    - echo
    - '@ruby:%i[trace2 trace1 debug info warn error fatal unknown].each{|i|Log.log.send(i,"<"*80)};"ok"'
    - --log-level=trace2

#######################################################################################################################
prev_check:
  command:
    - preview
    - check
    - --skip-types=office
prev_dcm:
  command:
    - preview
    - test
    - --base=$(TMP
    - /
    - test_name)
    - "@preset:file.dcm"
prev_dcm_mm:
  command:
    - preview
    - test
    - --mimemagic=yes
    - --base=$(TMP
    - /
    - test_name)
    - "@preset:file.dcm"
prev_jpg_unk_mm:
  command:
    - preview
    - test
    - --mimemagic=yes
    - --base=$(TMP
    - /
    - test_name)
    - "@preset:file.jpg_unk"
prev_mxf_blend:
  command:
    - preview
    - test
    - --base=$(TMP
    - /
    - test_name)
    - "@preset:file.mxf"
    - mp4
    - --video-conversion=blend
    - --query=@json:{"text":true,"double":true}
prev_pdf:
  command:
    - preview
    - show
    - --base=$(TMP
    - /
    - test_name)
    - "@preset:file.pdf"
prev_txt:
  command:
    - preview
    - show
    - --base=$(TMP
    - /
    - test_name)
    - /etc/hosts
prev_docx:
  command:
    - preview
    - show
    - --base=$(TMP
    - /
    - test_name)
    - "@preset:file.docx"
prev_mpg_png_fix:
  command:
    - preview
    - show
    - --base=$(TMP
    - /
    - test_name)
    - "@preset:file.mpg"
    - --video-png-conv=fixed
prev_mpg_png_ani:
  command:
    - preview
    - show
    - --base=$(TMP
    - /
    - test_name)
    - "@preset:file.mpg"
    - --video-png-conv=animated
prev_mpg_reencode:
  command:
    - preview
    - show
    - --base=$(TMP
    - /
    - test_name)
    - "@preset:file.mpg"
    - mp4
    - --video-conversion=reencode
prev_mpg_clips:
  command:
    - preview
    - show
    - --base=$(TMP
    - /
    - test_name)
    - "@preset:file.mpg"
    - mp4
    - --video-conversion=clips
prev_trevents:
  command:
    - --preset=preview_ak
    - node
    - upload
    - "@preset:file.mxf"
    - "@preset:file.docx"
    - --ts=@json:{"target_rate_kbps":1000000,"resume_policy":"none"}
#	sleep 4
  command:
    - preview
    - trevents
    - --once-only=yes
    - --skip-types=office
    - --log-level=info
prev_events:
  command:
    - --preset=preview_ak
    - node
    - upload
    - "@preset:file.mxf"
    - "@preset:file.docx"
    - --ts=@json:{"target_rate_kbps":1000000,"resume_policy":"none"}
#	sleep 4
  command:
    - preview
    - events
    - --once-only=yes
    - --skip-types=office
    - --log-level=info
prev_scan:
  command:
    - preview
    - scan
    - --skip-types=office
    - --log-level=info
    - --skip-folder=/special/folder
  command:
    - preview
    - scan
    - --skip-folder=foo
    - --skip-folder=bar
    - --skip-folder=@list:,1,2
prev_folder:
  command:
    - preview
    - scan
    - --scan-id=1
    - --skip-types=office
    - --log-level=info
    - --file-access=remote
    - --ts=@json:{"target_rate_kbps":1000000}

#######################################################################################################################
# TODO : finalize
thot:
#	rm -fr source_hot
#	mkdir source_hot
  tags:
    - ignore_fail
  command:
    - server
    - delete
    - "@extend:@preset:server.upload_folder@/target_hot"
  command:
    - server
    - mkdir
    - "@extend:@preset:server.upload_folder@/target_hot"
#	echo hello > source_hot/new_file
  command:
    - server
    - upload
    - --to-folder=@extend:@preset:server.upload_folder@/target_hot
    - --lock-port=12345
    - --transfer-info=@json:{"ascp_args":["--remove-after-transfer","--remove-empty-directories","--exclude-newer-than=-8","--src-base","source_hot"]}
    - source_hot
  command:
    - server
    - browse
    - "@extend:@preset:server.upload_folder@/target_hot"
#ls -al source_hot
  post:
    - sleep TEMPORIZE_CREATE
  command:
    - server
    - upload
    - --to-folder=@extend:@preset:server.upload_folder@/target_hot
    - --lock-port=12345
    - --transfer-info=@json:{"ascp_args":["--remove-after-transfer","--remove-empty-directories","--exclude-newer-than=-8","--src-base","source_hot"]}
    - source_hot
  command:
    - server
    - browse
    - "@extend:@preset:server.upload_folder@/target_hot"
#ls -al source_hot
#rm -fr source_hot
#######################################################################################################################
tcos_info1:
  command:
    - cos
    - node
    - info
    - -N
    - --bucket=@preset:icos.bucket
    - --region=@preset:icos.region
    - --service-credentials=@json:@file:@preset:file.cos_svc_cred
tcos_info2:
  command:
    - cos
    - node
    - info
    - -N
    - --bucket=@preset:icos.bucket
    - --endpoint=@preset:icos.endpoint
    - --apikey=@preset:icos.api_key
    - --crn=@preset:icos.resource_instance_id
tcos_info3:
  command:
    - cos
    - node
    - info
    - --log-level=trace2
tcos_show:
  tags:
    - ignore_fail
    - nodoc
  command:
    - cos
    - node
    - access_key
    - show
    - self
tcos_upload:
  command:
    - cos
    - node
    - upload
    - $(TST_ASC_LCL_PATH)
tcos_download:
  depends_on:
    - tcos_upload
  command:
    - cos
    - node
    - download
    - $(TST_ASC_FILENAME)
    - --to-folder=$(TMP)

#######################################################################################################################
f5_health:
  command:
    - faspex5
    - health
    - -N
    - --url=@preset:faspex5_user.url
f5_health_bad:
  command:
    - faspex5
    - health
    - --url=https://www.ibm.com
f5_health_nagios:
  tags:
    - must_fail
  command:
    - faspex5
    - health
    - -N
    - --url=https://www.ibm.com
    - --format=nagios
f5_detect:
  command:
    - config
    - detect
    - "@preset:faspex5_user.url"
    - faspex5
f5_wizard:
  command:
    - config
    - wizard
    - "@preset:faspex5_user.url"
    - faspex5
    - --key-path=@preset:file.private_key
    - --preset=faspex5_user
  command:
    - config
    - wizard
    - "@preset:faspex5_user.url"
    - faspex5
    - --key-path=@preset:file.private_key
    - --url=
    - --username=a@b.c
  command:
    - config
    - wizard
    - https://eudemo.asperademo.com
    - faspex5
    - --username=admin@ibm.com
    - --key-path=
    - --show-secrets=yes
    - --client-id=abc
    - --client-secret=abc
  tags:
    - hide_fail
  command:
    - config
    - detect
    - https://eudemo.asperademo.com:22
    - faspex5
  command:
    - -N
    - config
    - detect
    - "@preset:faspex5_user.url"
  command:
    - config
    - detect
    - "@preset:faspex5_user.url"
f5_version:
  command:
    - faspex5
    - version
f5_pack_rcv_init:
  command:
    - faspex5
    - packages
    - receive
    - INIT
    - --once-only=yes
f5_p1:
  command:
    - faspex5
    - packages
    - send
    - '@json:@extend:{"title":"test
    - title","recipients":[{"name":"@preset:faspex5_user.username@"}]@preset:faspex5.meta@}'
    - $(TST_ASC_LCL_PATH)
    - --ts=@json:{"content_protection_password":"my_secret_here"}
f5_pack_list:
  command:
    - faspex5
    - packages
    - list
    - --query=@json:{"mailbox":"inbox","status":"completed"}
  command:
    - faspex5
    - packages
    - list
    - --box=ALL
    - --preset=f5_admin
  command:
    - faspex5
    - packages
    - list
    - --box=outbox
    - --fields=DEF,sender.email,recipients.0.recipient_type
f5_sh_folder_list:
  command:
    - faspex5
    - shared_folders
    - list
f5_sh_folder_br:
  command:
    - faspex5
    - shared_folders
    - browse
    - "@extend:%name:@preset:faspex5.shared_folder_name@"
f5_p3a:
  tags:
    - save_output
  command:
    - faspex5
    - packages
    - send
    - --shared-folder=@extend:%name:@preset:faspex5.shared_folder_name@
    - '@json:@extend:{"title":"test
    - title","recipients":["@preset:misc.email_internal@"]}'
    - "@preset:faspex5.shared_folder_file"
    - --fields=id
    - --display=data
#@echo "Sent package with id: $(read_value_from 'f5_p3b')"
  command:
    - faspex5
    - packages
    - status
    - $(read_value_from 'f5_p3a')
    - "@list:,failed,completed"
f5_p3b:
  depends_on:
    - f5_p3a
  tags:
    - save_output
  command:
    - faspex5
    - packages
    - list
    - --query=@json:{"status":"completed","max":1}
    - --fields=id
f5_p3c:
  command:
    - faspex5
    - packages
    - show
    - $(read_value_from 'f5_p3b')
f5_p3d:
  command:
    - faspex5
    - packages
    - status
    - $(read_value_from 'f5_p3b')
f5_p3e:
  command:
    - faspex5
    - packages
    - browse
    - $(read_value_from 'f5_p3b')
    - --query=@json:{"recursive":true}
f5_p3f:
  command:
    - faspex5
    - packages
    - receive
    - $(read_value_from 'f5_p3b')
    - --to-folder=$(TMP)
    - --ts=@json:{"content_protection_password":"my_secret_here"}
f5_p3g:
  command:
    - faspex5
    - packages
    - receive
    - ALL
    - --once-only=yes
    - --to-folder=$(TMP)
f5_p3h:
  command:
    - faspex5
    - packages
    - delete
    - $(read_value_from 'f5_p3b')
f5_pack_shbox:
  command:
    - faspex5
    - packages
    - send
    - '@json:@extend:{"title":"test
    - title","recipients":["@preset:faspex5.shared_box_name@"],"metadata":{"Options":"Opt1","TextInput":"example
    - text"}}'
    - $(TST_ASC_LCL_PATH)
#	echo "Waiting for package to be available" && sleep 30
f5_pack_shboxb:
  command:
    - faspex5
    - packages
    - list
    - --box=@preset:faspex5.shared_box_name
f5_pack_shboxc:
  tags:
    - save_output
  command:
    - faspex5
    - packages
    - list
    - --box=@preset:faspex5.shared_box_name
    - --query=@json:{"status":"completed","limit":1,"max":1}
    - --fields=id
    - --format=csv
    - --display=data
f5_pack_shboxd:
  command:
    - faspex5
    - packages
    - show
    - --box=@preset:faspex5.shared_box_name
    - $(read_value_from 'f5_pack_shboxc')
f5_pack_shboxe:
  command:
    - faspex5
    - packages
    - receive
    - --box=@preset:faspex5.shared_box_name
    - $(read_value_from 'f5_pack_shboxc')
    - --to-folder=$(TMP)
f5_pack_shbox_public:
  command:
    - faspex5
    - packages
    - send
    - -N
    - --url=@preset:faspex5.public_link_send_shared_box
    - '@json:@extend:{"title":"test
    - title"}'
    - $(TST_ASC_LCL_PATH)
f5_pack_user_public:
  command:
    - faspex5
    - packages
    - send
    - -N
    - --url=@preset:faspex5.public_link_send_f5_user
    - '@json:@extend:{"title":"test
    - title"}'
    - $(TST_ASC_LCL_PATH)
f5_pack_wrkgrp:
  command:
    - faspex5
    - packages
    - send
    - '@json:@extend:
    - {"title":"test
    - title","recipients":["@preset:faspex5.workgroup@"]}'
    - $(TST_ASC_LCL_PATH)
  post:
    - sleep TEMPORIZE_CREATE
f5_pack_wrkgrpb:
  command:
    - faspex5
    - packages
    - list
    - --box=@preset:faspex5.workgroup
    - --group-type=workgroups
f5_pack_wrkgrpc:
  tags:
    - save_output
  command:
    - faspex5
    - packages
    - list
    - --box=@preset:faspex5.workgroup
    - --group-type=workgroups
    - --query=@json:{"status":"completed","limit":1,"max":1}
    - --fields=id
    - --format=csv
    - --display=data
f5_pack_wrkgrpd:
  command:
    - faspex5
    - packages
    - show
    - --box=@preset:faspex5.workgroup
    - --group-type=workgroups
    - $(read_value_from 'f5_pack_wrkgrpc')
f5_pack_wrkgrpe:
  command:
    - faspex5
    - packages
    - receive
    - --box=@preset:faspex5.workgroup
    - --group-type=workgroups
    - $(read_value_from 'f5_pack_wrkgrpc')
    - --to-folder=$(TMP)
f5_sh_fold:
  command:
    - faspex5
    - shared
    - list
  command:
    - faspex5
    - shared
    - browse
    - "%name:@preset:faspex4.src"
f5_user_res:
  command:
    - faspex5
    - bearer_token
  command:
    - faspex5
    - admin
    - contacts
    - list
  command:
    - faspex5
    - admin
    - workgroups
    - list
  command:
    - faspex5
    - admin
    - shared_inboxes
    - list
    - 
  command:
    - faspex5
    - admin
    - workgroups
    - list
  command:
    - faspex5
    - admin
    - saml_configs
    - list
  command:
    - faspex5
    - admin
    - metadata_profiles
    - list
  command:
    - faspex5
    - admin
    - configuration
    - show
f5_dist_list:
  command:
    - faspex5
    - admin
    - distribution_lists
    - list
    - --query=@json:{"type":"global"}
  command:
    - faspex5
    - admin
    - distribution_lists
    - create
    - '@json:{"name":"test4","contacts":[{"name":"john@example.com"}]}'
  post:
    - sleep TEMPORIZE_CREATE
  command:
    - faspex5
    - admin
    - distribution_lists
    - delete
    - "%name:test4"
f5_adm_acc_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - accounts
    - list
f5_adm_job_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - jobs
    - list
    - --query=@json:{"job_type":"email","status":"failed"}
    - --fields=id,error_desc
f5_adm_nod_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - list
    - 
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - show
    - "%name:Local"
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - browse
    - "%name:Local"
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - shared_folders
    - "%name:Local"
    - list
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - shared_folders
    - "%name:Local"
    - show
    - "%name:Main"
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - node
    - shared_folders
    - "%name:Local"
    - user
    - "%name:Main"
    - list
f5_adm_api_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - oauth_clients
    - list
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - alternate_addresses
    - list
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - email_notifications
    - list
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - email_notifications
    - show
    - welcome_email
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - configuration
    - modify
    - '@json:{"mfa_required":false}'
f5_adm_reg_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - registrations
    - list
f5_adm_sbx_lst:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - list
    - --query=@json:{"all":true}
f5_adm_sbx_mem:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - members
    - "@extend:%name:@preset:faspex5.shared_box_name@"
    - list
f5_adm_sbx_cr:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - members
    - "@extend:%name:@preset:faspex5.shared_box_name@"
    - create
    - "%name:john@example.com"
    - submit_only
f5_adm_sbx_del:
  depends_on:
    - f5_adm_sbx_cr
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - members
    - "@extend:%name:@preset:faspex5.shared_box_name@"
    - delete
    - "%name:john@example.com"
f5_adm_evt_app:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - event
    - app
    - --query=@json:{"max":20}
f5_adm_evt_web:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - event
    - web
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - invite
    - "@extend:%name:@preset:faspex5.shared_box_name@"
    - johnny@example.com
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - shared_inboxes
    - members
    - "@extend:%name:@preset:faspex5.shared_box_name@"
    - delete
    - "%name:johnny@example.com"
f5_clean_del:
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - clean_deleted
f5_smtp:
  tags:
    - must_fail
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - smtp
    - create
    - '@json:{"auth_type":"open","server_address":"smtp.gmail.com","server_port":587,"domain":"gmail.com","tls_enabled":true,"packages_recipient_from":"sender"}'
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - smtp
    - modify
    - '@json:{"default_time_zone_offset":"0"}'
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - smtp
    - show
  command:
    - --preset=f5_admin
    - faspex5
    - admin
    - smtp
    - test
    - "@preset:misc.email_external"
f5_user:
  command:
    - faspex5
    - user
    - account
  command:
    - faspex5
    - user
    - account
    - --query.expand=true
  command:
    - faspex5
    - user
    - profile
    - show
  command:
    - faspex5
    - user
    - profile
    - modify
    - '@json:{"preference":{"connect_disabled":false}}'
f5_invite:
  command:
    - faspex5
    - invitations
    - create
    - '@json:{"email_address":"aspera.user1+u@gmail.com"}'
  command:
    - faspex5
    - invitation
    - list
  command:
    - faspex5
    - invitation
    - list
    - --fields=id
    - --display=data
    - --format=csv
    - |
    - 
    - faspex5
    - invitation
    - delete
    - --bulk=yes
    - "@lines:@stdin:"
f5_webauth:
  command:
    - --preset=f5_web
    - faspex5
    - version
f5_fxgw:
#	rm -f $(TMP)pid_f5_fxgw
  command:
    - faspex5
    - gateway
    - --pid-file=$(TMP)pid_f5_fxgw
    - '@json:{"url":"https://localhost:12346/aspera/faspex"}'
#	let i=10;while test $$i -gt 0 -a ! -f $(TMP)pid_f5_fxgw;do sleep 1;let --i;done
#	kill -0 $$(cat $(TMP)pid_f5_fxgw)
  command:
    - -N
    - faspex
    - --url=https://localhost:12346/aspera/faspex
    - --username=_unused_
    - --password=_unused_
    - package
    - send
    - --delivery-info=@json:{"recipients":["laurent.martin.aspera@fr.ibm.com"],"title":"gateway aoc"}
    - faux:///test1?1m
#	-curl -k https://localhost:12346/aspera/faspex/send -d 'bad'
#	-curl -k https://localhost:12346/aspera/faspex/bad -d 'bad'
#	kill -TERM $$(cat $(TMP)pid_f5_fxgw)
#	let i=10;while test $$i -gt 0 -a -f $(TMP)pid_f5_fxgw;do sleep 1;let --i;done
f5_postproc:
#	-kill -TERM $$(cat $(TMP)pid_f5_postproc)
#	rm -f $(TMP)pid_f5_postproc
#	openssl req -x509 -newkey rsa:2048 -sha256 -days 365 -nodes -keyout $(TMP)key.pem -out $(TMP)cert.pem -subj "/CN=localhost"
#	openssl pkcs12 -export -out $(TMP)localhost.p12 -inkey $(TMP)key.pem -in $(TMP)cert.pem -passout pass:changeit
  command:
    - faspex5
    - postprocessing
    - --pid-file=$(TMP)pid_f5_postproc
    - '@json:{"url":"https://localhost:8553/asclihook","script_folder":"$(DIR_TST)","cert":"$(TMP)localhost.p12","key":"changeit"}'
#	let i=10;while test $$i -gt 0 -a ! -f $(TMP)pid_f5_postproc;do sleep 1;let --i;done
#	kill -0 $$(cat $(TMP)pid_f5_postproc)&&echo ">>>> Process $$(cat $(TMP)pid_f5_postproc)"
  command:
    - faspex5
    - packages
    - send
    - '@json:@extend:{"title":"test_webhook_ascli","recipients":["@preset:faspex5.shared_box_name@"]}'
    - faux:///test1?1m
#	-curl -k https://localhost:8553/asclihook/post_proc_test.sh -d '{"faspex_pkg_directory":"/package test - 61ae5292-d8ef-496e-8b15-8cdc0379fc4a.aspera-package/PKG - package test","faspex_pkg_name":"Test files","faspex_pkg_note":"","faspex_pkg_id":506,"faspex_pkg_delivery_id":506,"faspex_recipient_list":"aspera-recipient-test@ibm.com","faspex_recipient_count":1,"faspex_sender_id":30,"faspex_sender_name":"aspera-sender-test@ibm.com","faspex_sender_email":"aspera-sender-test@ibm.com","faspex_pkg_total_bytes":4633,"faspex_pkg_total_files":1,"faspex_pkg_uuid":"61ae5299-d8ea-496e-8b15-8cdc0379fc4a","faspex_metadata_fields": "{\"_pkg_uuid\":\"61ae5292-d8ef-496e-8b15-8cdc0379fc4a\",\"_pkg_name\":\"Test files\",\"_created_utc\":\"2022-1209T17:47:03.545Z\"}","faspex_recipient_0":"aspera-sender-test@ibm.com"}'
#	-curl -k https://localhost:8553/wrong -d '{}'
#	sleep 5
#	kill -TERM $$(cat $(TMP)pid_f5_postproc)
#	let i=10;while test $$i -gt 0 -a -f $(TMP)pid_f5_postproc;do sleep 1;let --i;done
  command:
    - faspex5
    - postprocessing
    - --pid-file=$(TMP)pid_f5_postproc
    - '@json:{"url":"https://localhost:8553/asclihook","script_folder":"$(DIR_TST)","key":"$(TMP)key.pem"}'
#    - sleep 5
#	kill -TERM $$(cat $(TMP)pid_f5_postproc)
  command:
    - faspex5
    - postprocessing
    - --pid-file=$(TMP)pid_f5_postproc
    - '@json:{"url":"https://localhost:8553/asclihook","script_folder":"$(DIR_TST)","cert":"$(TMP)cert.pem","key":"$(TMP)key.pem"}'
#    - sleep 5
#	kill -TERM $$(cat $(TMP)pid_f5_postproc)
f5_cert_test:
  command:
    - faspex5
    - postprocessing
    - --pid-file=$(TMP)pid_f5_cert_test
    - '@json:{"url":"http://localhost:18080/domain","script_folder":"$(DIR_TST)"}'
#	let i=10;while test $$i -gt 0 -a ! -f $(TMP)pid_f5_cert_test;do sleep 1;let --i;done
#	kill $$(cat $(TMP)pid_f5_cert_test)
  command:
    - faspex5
    - postprocessing
    - --pid-file=$(TMP)pid_f5_cert_test
    - '@json:{"url":"https://localhost:18443/domain","certificate":{},"script_folder":"$(DIR_TST)"}'
#	let i=10;while test $$i -gt 0 -a ! -f $(TMP)pid_f5_cert_test;do sleep 1;let --i;done
#	kill $$(cat $(TMP)pid_f5_cert_test)
#	openssl req -newkey rsa:2048 -x509 -days 365 -nodes -keyout $(TMP)private_key.pem -out $(TMP)certificate.pem -subj "/CN=MyCert"
  command:
    - faspex5
    - postprocessing
    - --pid-file=$(TMP)pid_f5_cert_test
    - '@json:{"url":"https://localhost:18443/domain","certificate":{"cert":"$(TMP)certificate.pem","chain":"$(TMP)certificate.pem","key":"$(TMP)private_key.pem"},"script_folder":"$(DIR_TST)"}'
#	let i=10;while test $$i -gt 0 -a ! -f $(TMP)pid_f5_cert_test;do sleep 1;let --i;done
#	kill $$(cat $(TMP)pid_f5_cert_test)
#	openssl pkcs12 -export -out $(TMP)certificate.p12 -inkey $(TMP)private_key.pem -in $(TMP)certificate.pem -name "MyCertAlias" -passout pass:$(PKCS_P)
  command:
    - faspex5
    - postprocessing
    - --pid-file=$(TMP)pid_f5_cert_test
    - '@json:{"url":"https://localhost:18443/domain","certificate":{"pkcs12":"$(TMP)certificate.p12","key":"$(PKCS_P)"},"script_folder":"$(DIR_TST)"}'
#	let i=10;while test $$i -gt 0 -a ! -f $(TMP)pid_f5_cert_test;do sleep 1;let --i;done
#	kill $$(cat $(TMP)pid_f5_cert_test)

#######################################################################################################################
httpgw_nagios:
  command:
    - httpgw
    - health
httpgw_info:
  command:
    - httpgw
    - info
httpgw_detect:
  command:
    - config
    - detect
    - "@preset:tst_httpgw.url"
    - httpgw

#######################################################################################################################
faspio_health:
  command:
    - faspio
    - health
faspio_detect:
  command:
    - config
    - detect
    - "@preset:tst_faspio.url"
    - faspio
faspio_wizard:
  command:
    - config
    - wizard
    - "@preset:tst_faspio.url"
    - faspio
    - --username=@preset:tst_faspio.username
    - --password=@preset:tst_faspio.password
faspio_blist:
  command:
    - faspio
    - bridges
    - list
faspio_bcreate:
  command:
    - faspio
    - bridges
    - create
    - '@json:{"name":"test1","local":{"protocol":"tcp","tls_enabled":false,"port":"3000","bind_address":"127.0.0.1"},"forward":{"protocol":"fasp","tls_enabled":false,"port":"3994","bind_address":"127.0.0.1","host":["10.0.0.1"]}}'
faspio_bclean_list:
  tags:
    - save_output
  command:
    - faspio
    - bridges
    - list
    - --fields=id
    - --format=json
faspio_bclean:
  depends_on: faspio_bclean_list
  command:
    - faspio
    - bridges
    - delete
    - --bulk=yes
    - "@json:$(read_value_from 'faspio_bclean_list')"

#######################################################################################################################
alee_nagios:
  command:
    - -N
    - alee
    - health
alee_entitlement:
  command:
    - alee
    - entitlement

#######################################################################################################################
f4_health:
  command:
    - faspex
    - health
f4_health_bad:
  command:
    - faspex
    - health
    - --url=https://wrong.example.com
f4_detect:
  command:
    - config
    - detect
    - "@preset:faspex4_user.url"
f4_wizard:
  command:
    - config
    - wizard
    - "@preset:faspex4_user.url"
    - faspex
    - --username=test
    - --password=test
f4_pack_list:
  command:
    - faspex
    - package
    - list
    - --query.max=5
f4_pack_send:
  command:
    - faspex
    - package
    - send
    - --delivery-info=@json:@extend:{"title":"$(name) $(PACKAGE_TITLE_BASE)","recipients":["@preset:misc.email_internal@","@preset:faspex4_user.username@"]}
    - $(TST_ASC_LCL_PATH)
#	@sleep 8
f4_prs:
  depends_on:
    - f4_pack_send
  tags:
    - save_output
  command:
    - faspex
    - package
    - list
    - --query.max=1
    - --fields=package_id
    - --display=data
    - --format=csv
f4_prsb:
  command:
    - faspex
    - package
    - receive
    - $(read_value_from 'f4_prs')
    - --to-folder=$(TMP)
f4_prsc:
  tags:
    - save_output
  command:
    - faspex
    - package
    - list
    - --box=sent
    - --query.max=1
    - --fields=package_id
    - --display=data
    - --format=csv
f4_prsd:
  command:
    - faspex
    - package
    - receive
    - $(read_value_from 'f4_prsc')
    - --to-folder=$(TMP)
    - --box=sent
f4_pria:
  tags:
    - save_output
  command:
    - faspex
    - package
    - list
    - --query.max=1
    - --fields=package_id
    - --display=data
    - --format=csv
f4_prib:
  command:
    - faspex
    - package
    - receive
    - $(read_value_from 'f4_pria')
    - --to-folder=$(TMP)
f4_prl:
  tags:
    - hide_fail
  command:
    - faspex
    - package
    - receive
    - --to-folder=$(TMP)
    - --link=@preset:faspex4.link_recv_from_user
f4_prall:
  command:
    - faspex
    - package
    - receive
    - ALL
    - --once-only=yes
    - --to-folder=$(TMP)
    - --query=@json:{"max":10}
f4_pslu:
  command:
    - faspex
    - package
    - send
    - --link=@preset:faspex4.link_send_to_user
    - --delivery-info=@json:{"title":"$(name) $(PACKAGE_TITLE_BASE)"}
    - $(TST_ASC_LCL_PATH)
f4_psld:
  command:
    - faspex
    - package
    - send
    - --link=@preset:faspex4.link_send_to_dropbox
    - --delivery-info=@json:{"title":"$(name) $(PACKAGE_TITLE_BASE)"}
    - $(TST_ASC_LCL_PATH)
f4_remote_src:
  command:
    - faspex
    - source
    - list
f4_remote_srcb:
  command:
    - faspex
    - source
    - info
    - "%name:@preset:faspex4.src"
    - --storage=@preset:faspex4_storage
f4_remote_srcc:
  command:
    - faspex
    - source
    - node
    - "%name:@preset:faspex4.src"
    - br
    - /
    - --storage=@preset:faspex4_storage
f4_remote_srcd:
  command:
    - faspex
    - package
    - send
    - --delivery-info=@json:@extend:{"title":"$(name) $(PACKAGE_TITLE_BASE)","recipients":["@preset:misc.email_internal@"]}
    - --remote-source=@extend:%name:@preset:faspex4.src
    - sample_source.txt
f4_misc:
  command:
    - faspex
    - me
f4_miscb:
  command:
    - faspex
    - address_book
f4_miscc:
  command:
    - faspex
    - login_methods
f4_v4:
  command:
    - --preset=faspex4_admin
    - faspex
    - v4
    - dropbox
    - list
f4_v4b:
  command:
    - --preset=faspex4_admin
    - faspex
    - v4
    - dmembership
    - list
f4_v4c:
  command:
    - --preset=faspex4_admin
    - faspex
    - v4
    - workgroup
    - list
f4_v4d:
  command:
    - --preset=faspex4_admin
    - faspex
    - v4
    - wmembership
    - list
f4_v4e:
  command:
    - --preset=faspex4_admin
    - faspex
    - v4
    - user
    - list
f4_v4f:
  command:
    - faspex
    - v4
    - metadata_profile
    - list
f4_db1:
  command:
    - faspex
    - dropbox
    - list
    - --recipient=@extend:*@preset:faspex4.dbx@
f4_db1b:
  command:
    - faspex
    - package
    - send
    - --delivery-info=@json:@extend:{"title":"$(name) $(PACKAGE_TITLE_BASE)","recipients":[*@preset:faspex4.dbx@]}
    - $(TST_ASC_LCL_PATH)
f4_db1c:
  tags:
    - save_output
  command:
    - faspex
    - package
    - list
    - --recipient=@extend:*@preset:faspex4.dbx@
    - --format=csv
    - --fields=package_id
    - --query.max=1
f4_db1d:
  command:
    - faspex
    - package
    - receive
    - $(read_value_from 'f4_db1c')
    - --recipient=@extend:*@preset:faspex4.dbx@
    - --to-folder=$(TMP)
f4_db1e:
  command:
    - faspex
    - dropbox
    - list
    - --recipient=@extend:*@preset:faspex4.dbx@
f4_db1f:
  command:
    - faspex
    - package
    - send
    - --delivery-info=@json:@extend:{"title":"$(name) $(PACKAGE_TITLE_BASE)","recipients":[*@preset:faspex4.wkg@]}
    - $(TST_ASC_LCL_PATH)
#	sleep 10
f4_db1g:
  tags:
    - save_output
  command:
    - faspex
    - package
    - list
    - --recipient=@extend:*@preset:faspex4.wkg@
    - --format=csv
    - --fields=package_id
    - --query.max=1
f4_db1h:
  command:
    - faspex
    - package
    - receive
    - $(read_value_from 'f4_db1g')
    - --recipient=@extend:*@preset:faspex4.wkg@
    - --to-folder=$(TMP)
#######################################################################################################################
